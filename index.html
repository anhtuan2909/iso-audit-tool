<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Audit Tool - ISO 27001:2022 Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .screen { display: none; }
        .screen.active { display: block; }
        .progress-bar { transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1); width: var(--progress-width, 0%); }
        #sectionList button.active { background-color: #059669; color: white; font-weight: 600; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1); }
        #evidenceList::-webkit-scrollbar { width: 6px; }
        #evidenceList::-webkit-scrollbar-thumb { background-color: #d1fae5; border-radius: 999px; }
        #evidenceList::-webkit-scrollbar-thumb:hover { background-color: #10b981; }
        .btn-hover-effect:hover { transform: translateY(-1px); }
        .btn-hover-effect:active { transform: translateY(0px); }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div id="screen-setup" class="screen active max-w-2xl mx-auto p-10 bg-white shadow-2xl rounded-2xl mt-20 border border-slate-100">
        <div class="text-center mb-10">
            <h1 class="text-4xl font-extrabold text-slate-800 tracking-tight">ISO 27001:2022 <span class="text-emerald-600">Master Audit</span></h1>
            <p class="text-slate-500 mt-2 text-lg">Công cụ đánh giá và tạo báo cáo ISO 27001:2022.</p>
        </div>
        <div class="space-y-6">
            <div>
                <label for="clientName" class="block text-sm font-bold text-slate-700 mb-2 uppercase">Tên Công ty / Tổ chức</label>
                <input type="text" id="clientName" class="block w-full p-4 border-2 border-slate-200 rounded-xl text-lg focus:border-emerald-500 focus:outline-none transition-colors" placeholder="Nhập tên Công ty / Tổ chức">
            </div>
            <button id="startButton" class="btn-hover-effect w-full bg-emerald-600 text-white py-4 rounded-xl text-xl font-bold hover:bg-emerald-700 transition shadow-lg">
                Bắt đầu Phiên Đánh giá
            </button>
        </div>
    </div>

    <div id="screen-audit" class="screen max-w-[95rem] mx-auto p-6 mt-6">
        <div class="flex flex-col lg:flex-row gap-8 h-[calc(100vh-6rem)]">
            <nav class="w-full lg:w-1/4 xl:w-1/5 bg-white shadow-xl rounded-2xl overflow-hidden border border-slate-200 flex flex-col">
                <div class="p-5 bg-slate-50 border-b border-slate-200">
                    <h2 class="text-lg font-extrabold text-emerald-700 uppercase">Nội dung đánh giá</h2>
                </div>
                <div class="flex-1 overflow-y-auto p-3"><ul id="sectionList" class="space-y-1.5"></ul></div>
            </nav>

            <div class="flex-1 flex flex-col gap-6 overflow-hidden">
                <div class="bg-white p-6 shadow-md rounded-2xl border border-slate-200 flex-shrink-0">
                    <div class="flex justify-between items-center mb-6">
                        <div>
                            <div class="text-sm font-semibold text-emerald-600 uppercase">Đang đánh giá</div>
                            <h1 class="text-3xl font-bold text-slate-800 truncate" id="clientNameDisplay"></h1>
                        </div>
                         <button id="saveReportButton" class="btn-hover-effect bg-emerald-600 text-white py-3 px-6 rounded-xl font-bold hover:bg-emerald-800 transition shadow-md flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>
                            Xuất Báo cáo
                        </button>
                    </div>
                    <div class="bg-slate-100 p-4 rounded-xl">
                        <div class="flex justify-between text-sm font-bold text-emerald-700 mb-2">
                            <span>Tiến độ tổng thể</span><span id="progressText" class="text-emerald-700">0/120</span>
                        </div>
                        <div class="w-full bg-slate-300 rounded-full h-4 overflow-hidden">
                            <div id="progressBar" class="progress-bar bg-gradient-to-r from-emerald-500 to-emerald-400 h-full rounded-full"></div>
                        </div>
                    </div>
                </div>

                <div class="flex-1 bg-white p-8 shadow-xl rounded-2xl border border-slate-200 overflow-y-auto flex flex-col">
                    <div class="flex-1">
                         <div class="mb-8">
                            <div class="flex items-center gap-3 mb-4">
                                <span class="px-4 py-1.5 bg-emerald-100 text-emerald-800 text-xs font-bold uppercase rounded-full" id="controlSection"></span>
                                <span class="font-mono text-sm text-slate-500 bg-slate-100 px-2 py-1 rounded-md border" id="controlId"></span>
                            </div>
                            <h2 class="text-2xl md:text-3xl font-bold text-slate-800 leading-tight" id="controlQuestion"></h2>
                            <div id="explanationArea" class="mt-5">
                                <details class="group border border-slate-200 rounded-xl overflow-hidden transition-all open:bg-emerald-50/30">
                                    <summary class="flex cursor-pointer items-center justify-between p-3 bg-slate-50 hover:bg-slate-100 transition">
                                        <span class="text-sm font-semibold text-emerald-700 flex items-center">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                                            Hướng dẫn đánh giá & Gợi ý bằng chứng
                                        </span>
                                        <span class="transition group-open:rotate-180"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-emerald-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg></span>
                                    </summary>
                                    <div id="explanationContent" class="p-5 text-sm text-slate-700 leading-relaxed border-t border-slate-200"></div>
                                </details>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 xl:grid-cols-12 gap-8">
                            <div class="xl:col-span-5 space-y-8">
                                <div>
                                    <label class="block text-sm font-bold text-slate-700 mb-3 uppercase">Trạng thái</label>
                                     <select id="controlStatus" class="block w-full p-3.5 border-2 border-slate-300 rounded-xl focus:border-emerald-500 bg-white font-medium shadow-sm">
                                        <option value="Bỏ qua" class="text-slate-400">(Chưa đánh giá)</option>
                                        <option value="Tuân thủ" class="text-emerald-600 font-bold">✓ Tuân thủ (Compliant)</option>
                                        <option value="Không Tuân thủ (NC)" class="text-red-600 font-bold">✕ Không tuân thủ (NC)</option>
                                        <option value="Không Áp dụng" class="text-slate-600 font-bold">○ Không áp dụng (N/A)</option>
                                    </select>
                                </div>
                                <div>
                                     <div class="flex justify-between items-center mb-3">
                                        <label class="block text-sm font-bold text-slate-700 uppercase">Bằng chứng (Files)</label>
                                        <span class="text-xs bg-slate-100 px-2 py-1 rounded-md">Đa tập tin</span>
                                    </div>
                                    <label class="flex flex-col items-center justify-center w-full h-36 border-2 border-slate-300 border-dashed rounded-xl cursor-pointer hover:bg-emerald-50 hover:border-emerald-400 transition relative">
                                        <div class="flex flex-col items-center justify-center pt-5 pb-6">
                                            <svg class="w-10 h-10 mb-3 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg>
                                            <p class="text-sm text-slate-500 font-medium"><span class="text-emerald-600 underline">Click tải lên</span> hoặc kéo thả file</p>
                                        </div>
                                        <input id="controlEvidenceUpload" type="file" class="hidden" multiple />
                                        <div id="uploadLoading" class="absolute inset-0 bg-white/80 hidden flex flex-col items-center justify-center">
                                             <span class="text-sm font-bold text-emerald-700 animate-pulse">Đang tải lên...</span>
                                        </div>
                                    </label>
                                    <div id="evidenceList" class="mt-4 space-y-2 max-h-[200px] overflow-y-auto pr-1"></div>
                                </div>
                            </div>
                            <div class="xl:col-span-7">
                                <label class="block text-sm font-bold text-slate-700 mb-3 uppercase">Ghi chú / Phát hiện (Findings)</label>
                                <textarea id="controlNote" rows="12" class="block w-full p-5 border-2 border-slate-300 rounded-xl focus:border-emerald-500 text-base resize-none bg-slate-50 focus:bg-white transition leading-relaxed" placeholder="Nhập chi tiết đánh giá..."></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="flex justify-between items-center pt-6 mt-8 border-t border-slate-100">
                        <button id="prevButton" class="btn-hover-effect flex items-center px-6 py-3 bg-white border-2 border-slate-200 text-slate-700 rounded-xl font-bold hover:bg-slate-50 transition disabled:opacity-50">Câu trước</button>
                        <div class="text-xl font-black text-slate-300 select-none tracking-widest" id="controlCounter">1 / 121</div>
                        <button id="nextButton" class="btn-hover-effect flex items-center px-8 py-3 bg-emerald-600 text-white rounded-xl font-bold hover:bg-emerald-700 transition shadow-lg">Tiếp theo</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="screen-done" class="screen max-w-3xl mx-auto p-12 bg-white shadow-2xl rounded-3xl mt-24 text-center border border-slate-100">
        <h1 class="text-4xl font-extrabold text-emerald-700 mb-4">Đánh giá Hoàn tất!</h1>
        <p class="text-slate-500 mb-10 text-xl">Báo cáo chuyên nghiệp đã được tải xuống.</p>
        <div class="bg-slate-50 p-6 rounded-2xl mb-10 border-2 border-slate-100 inline-block mx-auto">
             <div class="flex items-center justify-center text-slate-700 font-medium">
                <span id="reportFileName" class="text-lg break-all"></span>
             </div>
        </div>
        <button id="restartButton" class="btn-hover-effect w-full md:w-2/3 mx-auto block bg-slate-800 text-white py-4 px-8 rounded-2xl text-xl font-bold hover:bg-slate-900 transition shadow-lg">Bắt đầu phiên mới</button>
    </div>

<script>
const CHECKLIST_DATA = [
  {"section": "Điều khoản 4-10", "id": "4.1", "question": "(4.1) Đã có tài liệu xác định các vấn đề nội bộ/bên ngoài liên quan đến ATTT chưa?", "explanation": "<b>Ý nghĩa:</b> Xác định 'bối cảnh' tổ chức để đánh giá rủi ro. Bên ngoài (Luật NĐ13, đối thủ, xu hướng tấn công), Bên trong (Văn hóa, ngân sách, hạ tầng cũ/mới).<br><b>Bằng chứng:</b> Tài liệu 'Bối cảnh tổ chức', Phân tích SWOT ATTT."},
  {"section": "Điều khoản 4-10", "id": "4.2", "question": "(4.2) Đã có danh sách các bên quan tâm và các yêu cầu ATTT của họ chưa?", "explanation": "<b>Ý nghĩa:</b> Xác định rõ Khách hàng, Cơ quan quản lý, Cổ đông... đang mong đợi gì ở hệ thống bảo mật để đáp ứng đúng.<br><b>Bằng chứng:</b> Danh sách các bên liên quan và yêu cầu cụ thể."},
  {"section": "Điều khoản 4-10", "id": "4.3", "question": "(4.3) Đã có tài liệu định nghĩa Phạm vi ISMS (Scope document) rõ ràng và hợp lý chưa?", "explanation": "<b>Ý nghĩa:</b> Khoanh vùng ranh giới áp dụng ISMS (ghi rõ áp dụng tại văn phòng nào, cho hệ thống IT nào, phòng ban nào).<br><b>Bằng chứng:</b> Tài liệu Phạm vi ISMS (Scope Statement)."},
  {"section": "Điều khoản 4-10", "id": "4.4", "question": "(4.4) ISMS và các quy trình (Chính sách, Quy trình) đã được thiết lập chưa?", "explanation": "<b>Ý nghĩa:</b> Yêu cầu tổng quát, tổ chức phải xây dựng, vận hành và cải tiến hệ thống quản lý.<br><b>Bằng chứng:</b> Hệ thống tài liệu quy trình đã được ban hành."},
  {"section": "Điều khoản 4-10", "id": "5.1", "question": "(5.1) Lãnh đạo cấp cao có thể hiện sự cam kết không? (Bằng chứng: cấp nguồn lực, ngân sách)", "explanation": "<b>Ý nghĩa:</b> Lãnh đạo phải 'dẫn dắt' và 'chi tiền' (duyệt ngân sách, nhân sự, tham gia họp xem xét), không chỉ giao khoán cho IT.<br><b>Bằng chứng:</b> Biên bản họp có Lãnh đạo, Quyết định phê duyệt ngân sách ATTT."},
  {"section": "Điều khoản 4-10", "id": "5.2", "question": "(5.2) Chính sách ATTT (1.1) đã được Lãnh đạo cấp cao phê duyệt và truyền thông chưa?", "explanation": "<b>Ý nghĩa:</b> 'Hiến pháp' về bảo mật của công ty, phải được ban hành cao nhất.<br><b>Bằng chứng:</b> Chính sách ATTT có chữ ký Giám đốc, email thông báo toàn công ty."},
  {"section": "Điều khoản 4-10", "id": "5.3", "question": "(5.3) Đã có tài liệu phân công vai trò, trách nhiệm ATTT chưa? (Ví dụ: Ma trận RACI 7.2)", "explanation": "<b>Ý nghĩa:</b> 'Rõ người, rõ việc'. Ai chịu trách nhiệm chính (Accountable) khi có sự cố?<br><b>Bằng chứng:</b> Sơ đồ tổ chức ATTT, Ma trận phân nhiệm (RACI), JD."},
  {"section": "Điều khoản 4-10", "id": "6.1.1", "question": "(6.1.1) Đã có các hành động để giải quyết rủi ro và cơ hội (từ 4.1) chưa?", "explanation": "<b>Ý nghĩa:</b> Đảm bảo hệ thống đạt mục tiêu, giảm tác động xấu từ các vấn đề đã xác định ở 4.1.<br><b>Bằng chứng:</b> Kế hoạch giải quyết rủi ro/cơ hội (tích hợp RTP)."},
  {"section": "Điều khoản 4-10", "id": "6.1.2", "question": "(6.1.2) Đã có Quy trình Quản lý Rủi ro (2.1) và Ma trận Rủi ro (3.4) nhất quán chưa?", "explanation": "<b>Ý nghĩa:</b> Cần một 'công thức' thống nhất để tính điểm rủi ro (VD: Tác động x Khả năng).<br><b>Bằng chứng:</b> Quy trình Đánh giá rủi ro, Bảng tiêu chí chấm điểm."},
  {"section": "Điều khoản 4-10", "id": "6.1.2b", "question": "(6.1.2) Đã có kết quả đánh giá rủi ro (bảng rủi ro) và tiêu chí chấp nhận rủi ro được phê duyệt chưa?", "explanation": "<b>Ý nghĩa:</b> Kết quả chạy quy trình. Rủi ro mức nào (VD: Trung bình trở lên) thì phải xử lý?<br><b>Bằng chứng:</b> Báo cáo/File Excel đánh giá rủi ro chi tiết."},
  {"section": "Điều khoản 4-10", "id": "6.1.3", "question": "(6.1.3) Đã có Kế hoạch Xử lý Rủi ro (RTP - 3.5) chưa?", "explanation": "<b>Ý nghĩa:</b> Ai làm gì, bao giờ xong để giảm các rủi ro đã xác định?<br><b>Bằng chứng:</b> Kế hoạch xử lý rủi ro (Risk Treatment Plan - RTP)."},
  {"section": "Điều khoản 4-10", "id": "6.1.3b", "question": "(6.1.3) Đã có Tuyên bố Áp dụng (SoA) được phê duyệt, liên kết logic với RTP và liệt kê đủ 93 controls chưa?", "explanation": "<b>Ý nghĩa:</b> Tài liệu bắt buộc quan trọng nhất. Liệt kê 93 controls, cái nào dùng/không dùng, lý do.<br><b>Bằng chứng:</b> Tài liệu SoA (Statement of Applicability)."},
  {"section": "Điều khoản 4-10", "id": "6.2", "question": "(6.2) Đã có các mục tiêu ATTT đo lường được (KPIs) ngoài các mục tiêu trong chính sách 1.1 chưa?", "explanation": "<b>Ý nghĩa:</b> Mục tiêu SMART (VD: Giảm 20% sự cố, 98% uptime, 100% nhân viên được đào tạo).<br><b>Bằng chứng:</b> Bảng theo dõi KPI/Mục tiêu ATTT năm."},
  {"section": "Điều khoản 4-10", "id": "7.1", "question": "(7.1) Đã có bằng chứng về việc cung cấp nguồn lực (ngân sách, nhân sự) cho ISMS chưa?", "explanation": "<b>Ý nghĩa:</b> Có thực mới vực được đạo. Cần đủ người và tiền để vận hành hệ thống.<br><b>Bằng chứng:</b> Ngân sách ATTT được duyệt, quyết định bổ nhiệm đội ISMS."},
  {"section": "Điều khoản 4-10", "id": "7.2", "question": "(7.2) Đã có hồ sơ năng lực (chứng chỉ) của các nhân sự ATTT chủ chốt chưa?", "explanation": "<b>Ý nghĩa:</b> Người làm bảo mật phải có trình độ phù hợp (Competence).<br><b>Bằng chứng:</b> CV, bằng cấp, chứng chỉ (CISSP, CISM, Security+...) của đội IT/Security."},
  {"section": "Điều khoản 4-10", "id": "7.3", "question": "(7.3) Đã có bằng chứng về đào tạo nhận thức ATTT (A.6.3) chưa? (slide, danh sách tham dự, kết quả test)", "explanation": "<b>Ý nghĩa:</b> Đảm bảo tất cả nhân viên hiểu trách nhiệm cơ bản, không là 'điểm yếu' của hệ thống.<br><b>Bằng chứng:</b> Slide đào tạo, danh sách điểm danh, bài test sau khóa học."},
  {"section": "Điều khoản 4-10", "id": "7.4", "question": "(7.4) Đã có quy trình truyền thông nội bộ và bên ngoài về ISMS chưa?", "explanation": "<b>Ý nghĩa:</b> Khi có sự cố thì báo ai? Ai được phát ngôn với báo chí?<br><b>Bằng chứng:</b> Kế hoạch truyền thông, quy trình phản ứng sự cố (phần liên lạc)."},
  {"section": "Điều khoản 4-10", "id": "7.5", "question": "(7.5) Đã có Quy trình Kiểm soát Thông tin dạng văn bản (Document Control) chưa? (Có mã, phiên bản, phê duyệt, thu hồi tài liệu cũ?)", "explanation": "<b>Ý nghĩa:</b> Đảm bảo mọi người dùng đúng phiên bản quy trình mới nhất.<br><b>Bằng chứng:</b> Quy trình kiểm soát tài liệu, Master List danh mục tài liệu."},
  {"section": "Điều khoản 4-10", "id": "8.1", "question": "(8.1) Đã có bằng chứng về việc lập kế hoạch và kiểm soát vận hành chưa? (Ví dụ: Quy trình 2.6 - Quản lý Thay đổi)", "explanation": "<b>Ý nghĩa:</b> Kiểm soát các thay đổi để không làm sập hệ thống.<br><b>Bằng chứng:</b> Quy trình quản lý thay đổi (Change Management), các phiếu RFC."},
  {"section": "Điều khoản 4-10", "id": "8.2", "question": "(8.2) Đã có Báo cáo Đánh giá Rủi ro (kết quả của Quy trình 2.1) chưa?", "explanation": "<b>Ý nghĩa:</b> Thực hiện đánh giá lại rủi ro định kỳ hoặc khi có thay đổi lớn.<br><b>Bằng chứng:</b> Các báo cáo đánh giá rủi ro gần nhất."},
  {"section": "Điều khoản 4-10", "id": "8.3", "question": "(8.3) Đã có bằng chứng về việc thực hiện các Kế hoạch Xử lý Rủi ro (RTP - 3.5) chưa?", "explanation": "<b>Ý nghĩa:</b> Đã lập kế hoạch thì phải làm (VD: RTP nói mua firewall thì phải có biên bản nghiệm thu firewall).<br><b>Bằng chứng:</b> Báo cáo tiến độ RTP, bằng chứng triển khai các dự án."},
  {"section": "Điều khoản 4-10", "id": "9.1", "question": "(9.1) Tổ chức có đo lường, giám sát, phân tích và đánh giá ISMS không? (Có báo cáo KPI/metric không?)", "explanation": "<b>Ý nghĩa:</b> Không đo lường thì không quản lý được. Phải biết hệ thống đang khỏe hay yếu.<br><b>Bằng chứng:</b> Báo cáo giám sát định kỳ, dashboard KPI ATTT."},
  {"section": "Điều khoản 4-10", "id": "9.2", "question": "(9.2) Đã có Chương trình và Báo cáo Đánh giá Nội bộ (3.1) gần nhất chưa? Đánh giá có khách quan không?", "explanation": "<b>Ý nghĩa:</b> Tự 'khám bệnh' định kỳ. Đảm bảo khách quan (không tự đánh giá việc mình làm).<br><b>Bằng chứng:</b> Kế hoạch & Báo cáo đánh giá nội bộ, các phiếu ghi nhận lỗi (NC)."},
  {"section": "Điều khoản 4-10", "id": "9.3", "question": "(9.3) Đã có bằng chứng về cuộc họp Xem xét của Lãnh đạo (Management Review) gần nhất chưa? (slide, biên bản họp, danh sách tham dự)", "explanation": "<b>Ý nghĩa:</b> Cuộc họp quan trọng nhất năm để Lãnh đạo nắm tình hình và chỉ đạo.<br><b>Bằng chứng:</b> Biên bản họp Management Review (bắt buộc)."},
  {"section": "Điều khoản 4-10", "id": "9.3b", "question": "(9.3) Cuộc họp Xem xét của Lãnh đạo có đủ các đầu vào (inputs) theo yêu cầu 9.3.2 không? (kết quả rủi ro, audit, sự cố...)", "explanation": "<b>Ý nghĩa:</b> Đảm bảo báo cáo đủ các thông tin đầu vào bắt buộc theo chuẩn ISO.<br><b>Bằng chứng:</b> Slide báo cáo trong cuộc họp (check list các mục)."},
  {"section": "Điều khoản 4-10", "id": "10.1", "question": "(10.1) Đã có bằng chứng về các cơ hội cải tiến (từ 9.3) chưa?", "explanation": "<b>Ý nghĩa:</b> Hệ thống phải luôn được cải tiến tốt hơn (Continual Improvement).<br><b>Bằng chứng:</b> Danh sách các sáng kiến/dự án cải tiến ATTT."},
  {"section": "Điều khoản 4-10", "id": "10.2", "question": "(10.2) Các Điểm không phù hợp (NCs) (từ 9.2) đã được phân tích nguyên nhân gốc rễ và thực hiện hành động khắc phục chưa?", "explanation": "<b>Ý nghĩa:</b> Sai phải sửa tận gốc để không lặp lại.<br><b>Bằng chứng:</b> Các phiếu hành động khắc phục (CAR), báo cáo phân tích nguyên nhân gốc rễ (Root Cause Analysis)."},
  {"section": "A.5 Tổ chức", "id": "A.5.1", "question": "(A.5.1) Chính sách ATTT (1.1) và các chính sách chuyên đề (1.2-1.10) đã được phê duyệt, ban hành, truyền thông chưa?", "explanation": "<b>Ý nghĩa:</b> Các 'bộ luật' con (VD: Chính sách mật khẩu, AUP, Truy cập) phải được ban hành.<br><b>Bằng chứng:</b> Hệ thống văn bản chính sách trên Portal nội bộ."},
  {"section": "A.5 Tổ chức", "id": "A.5.2", "question": "(A.5.2) Đã có Ma trận RACI (7.2), Mô tả công việc? Nhân sự có hiểu trách nhiệm ATTT của mình không?", "explanation": "<b>Ý nghĩa:</b> Phân vai rõ ràng trong từng quy trình ATTT cụ thể.<br><b>Bằng chứng:</b> Ma trận RACI cho các quy trình chính (Sự cố, Thay đổi)."},
  {"section": "A.5 Tổ chức", "id": "A.5.3", "question": "(A.5.3) Các quy trình nhạy cảm (Quản lý thay đổi, Cấp quyền) có đảm bảo phân tách nhiệm vụ (người yêu cầu, phê duyệt, thực hiện khác nhau) không?", "explanation": "<b>Ý nghĩa:</b> Tránh 'vừa đá bóng vừa thổi còi'. Dev không nên tự deploy lên Production.<br><b>Bằng chứng:</b> Quy trình cấp quyền, log hệ thống thể hiện sự phân tách."},
  {"section": "A.5 Tổ chức", "id": "A.5.4", "question": "(A.5.4) Cấp quản lý (Trưởng phòng) có thúc đẩy nhân viên tuân thủ chính sách ATTT không?", "explanation": "<b>Ý nghĩa:</b> Sếp phải làm gương thì lính mới nghe.<br><b>Bằng chứng:</b> Phỏng vấn nhân viên, các email nhắc nhở của quản lý."},
  {"section": "A.5 Tổ chức", "id": "A.5.5", "question": "(A.5.5) Tổ chức có xác định và duy trì liên lạc với các cơ quan có thẩm quyền (VNCERT/CC, A05...) không?", "explanation": "<b>Ý nghĩa:</b> Biết gọi ai khi bị tấn công lớn hoặc cần hỗ trợ pháp lý.<br><b>Bằng chứng:</b> Danh bạ liên lạc khẩn cấp (công an, cơ quan điều phối)."},
  {"section": "A.5 Tổ chức", "id": "A.5.6", "question": "(A.5.6) Tổ chức có tham gia các diễn đàn, hiệp hội ATTT chuyên ngành (ISACA, (ISC)²) không?", "explanation": "<b>Ý nghĩa:</b> Cập nhật kiến thức mới, tránh 'ếch ngồi đáy giếng'.<br><b>Bằng chứng:</b> Thẻ hội viên, chứng nhận tham gia hội thảo chuyên ngành."},
  {"section": "A.5 Tổ chức", "id": "A.5.7", "question": "(A.5.7) Tổ chức có thu thập và phân tích thông tin về mối đe dọa (Threat Intelligence) từ SOC/MSSP không? Có hành động gì được thực hiện không?", "explanation": "<b>Ý nghĩa:</b> 'Biết địch biết ta'. Chủ động phòng thủ trước các mối đe dọa mới.<br><b>Bằng chứng:</b> Báo cáo Threat Intel, các rule firewall cập nhật theo Intel."},
  {"section": "A.5 Tổ chức", "id": "A.5.8", "question": "(A.5.8) Các dự án đang chạy có được đánh giá rủi ro ATTT trong quá trình thực hiện không?", "explanation": "<b>Ý nghĩa:</b> Bảo mật phải đi cùng dự án từ đầu (Security by Design).<br><b>Bằng chứng:</b> Báo cáo đánh giá rủi ro dự án, biên bản họp khởi động."},
  {"section": "A.5 Tổ chức", "id": "A.5.9", "question": "(A.5.9) Danh sách Tài sản (3.2) có đầy đủ không (HW, SW, Data, Services...)?", "explanation": "<b>Ý nghĩa:</b> Không biết mình có gì thì không thể bảo vệ. Cần kiểm kê đủ.<br><b>Bằng chứng:</b> File Inventory/CMDB tài sản CNTT."},
  {"section": "A.5 Tổ chức", "id": "A.5.10", "question": "(A.5.10) Chính sách Sử dụng Chấp nhận được (AUP) đã được truyền thông (qua Sổ tay nhân viên) chưa?", "explanation": "<b>Ý nghĩa:</b> Quy định rõ được làm gì/cấm làm gì (VD: cấm game, web đen).<br><b>Bằng chứng:</b> Sổ tay nhân viên, cam kết AUP đã ký."},
  {"section": "A.5 Tổ chức", "id": "A.5.11", "question": "(A.5.11) Quy trình nghỉ việc (Off-boarding) của HR có đảm bảo nhân viên trả lại mọi tài sản (laptop, thẻ) không?", "explanation": "<b>Ý nghĩa:</b> Thu hồi tài sản và quan trọng nhất là cắt quyền truy cập ngay khi nghỉ.<br><b>Bằng chứng:</b> Checklist bàn giao nghỉ việc (có xác nhận IT)."},
  {"section": "A.5 Tổ chức", "id": "A.5.12", "question": "(A.5.12) Thông tin đã được phân loại (Mật, Nội bộ...) trong Chính sách (1.7) và Danh sách Tài sản (3.2) chưa?", "explanation": "<b>Ý nghĩa:</b> Phân loại để biết tài sản nào quan trọng cần ưu tiên bảo vệ.<br><b>Bằng chứng:</b> Quy định phân loại thông tin, danh sách tài sản có cột 'Mức độ mật'."},
  {"section": "A.5 Tổ chức", "id": "A.5.13", "question": "(A.5.13) Thông tin nhạy cảm (tài liệu, email, ổ đĩa) có được dán nhãn \"Mật\" (hoặc tương đương) không?", "explanation": "<b>Ý nghĩa:</b> Dán nhãn trực quan để người dùng dễ nhận biết và bảo vệ.<br><b>Bằng chứng:</b> Quan sát thực tế tài liệu/email có nhãn 'MẬT'/'INTERNAL'."},
  {"section": "A.5 Tổ chức", "id": "A.5.14", "question": "(A.5.14) Tổ chức có quy định về việc chuyển giao thông tin nhạy cảm ra ngoài (email, USB, Cloud) không?", "explanation": "<b>Ý nghĩa:</b> Kiểm soát đường đi của dữ liệu mật (VD: bắt buộc mã hóa khi gửi email ra ngoài).<br><b>Bằng chứng:</b> Quy định trao đổi thông tin, giải pháp DLP."},
  {"section": "A.5 Tổ chức", "id": "A.5.15", "question": "(A.5.15) Chính sách KSTC (1.2) và Quy trình (2.5) có dựa trên nguyên tắc \"Cần biết\" và \"Đặc quyền tối thiểu\" không?", "explanation": "<b>Ý nghĩa:</b> Chỉ cấp quyền vừa đủ để làm việc, không cấp dư thừa.<br><b>Bằng chứng:</b> Ma trận phân quyền (Access Matrix)."},
  {"section": "A.5 Tổ chức", "id": "A.5.16", "question": "(A.5.16) Quy trình tạo/xóa tài khoản có đảm bảo mọi tài khoản được liên kết duy nhất với một cá nhân/hệ thống không?", "explanation": "<b>Ý nghĩa:</b> Tránh dùng chung tài khoản để đảm bảo quy trách nhiệm.<br><b>Bằng chứng:</b> Danh sách user trên AD (không có user chung kiểu 'ketoan1')."},
  {"section": "A.5 Tổ chức", "id": "A.5.17", "question": "(A.5.17) Chính sách Mật khẩu (1.4) có được tuân thủ không (đủ phức tạp, đổi định kỳ, cấm mật khẩu mặc định, có MFA)?", "explanation": "<b>Ý nghĩa:</b> Mật khẩu yếu dễ bị hack. Cần độ phức tạp cao và khuyến nghị MFA.<br><b>Bằng chứng:</b> Cấu hình Password Policy trên AD/các hệ thống."},
  {"section": "A.5 Tổ chức", "id": "A.5.18", "question": "(A.5.18) Đã có hồ sơ (email, Biểu mẫu 3.6) rà soát quyền truy cập 6 tháng gần nhất? Chủ sở hữu tài sản có rà soát và phê duyệt không?", "explanation": "<b>Ý nghĩa:</b> Định kỳ kiểm tra để cắt quyền những người đã chuyển bộ phận.<br><b>Bằng chứng:</b> Biên bản rà soát quyền (Access Review) định kỳ."},
  {"section": "A.5 Tổ chức", "id": "A.5.19", "question": "(A.5.19) Tổ chức có đánh giá rủi ro ATTT của NCC (Cloud, ICT) trước khi ký hợp đồng không? (Xem Chính sách 1.10)", "explanation": "<b>Ý nghĩa:</b> 'Chọn bạn mà chơi'. Đảm bảo đối tác cũng an toàn.<br><b>Bằng chứng:</b> Phiếu đánh giá an ninh nhà cung cấp trước khi ký HĐ."},
  {"section": "A.5 Tổ chức", "id": "A.5.20", "question": "(A.5.20) Hợp đồng NCC (sample) có bao gồm các điều khoản ATTT ràng buộc (tuân thủ, báo cáo sự cố, quyền audit) không?", "explanation": "<b>Ý nghĩa:</b> Ràng buộc pháp lý trách nhiệm nếu họ làm lộ dữ liệu của mình.<br><b>Bằng chứng:</b> Hợp đồng mẫu, thỏa thuận bảo mật (NDA/DPA) với đối tác."},
  {"section": "A.5 Tổ chức", "id": "A.5.21", "question": "(A.5.21) Tổ chức quản lý rủi ro từ chuỗi cung ứng ICT (nhà cung cấp phần cứng, phần mềm) như thế nào?", "explanation": "<b>Ý nghĩa:</b> Tránh mua phải thiết bị/phần mềm có cài sẵn mã độc (Supply Chain Attack).<br><b>Bằng chứng:</b> Quy trình mua sắm ICT, yêu cầu CO/CQ, scan thiết bị trước khi dùng."},
  {"section": "A.5 Tổ chức", "id": "A.5.22", "question": "(A.5.22) Tổ chức có rà soát hiệu suất ATTT của các NCC quan trọng hàng năm không (yêu cầu chứng chỉ, báo cáo)?", "explanation": "<b>Ý nghĩa:</b> Giám sát định kỳ xem đối tác còn giữ vững phong độ bảo mật không.<br><b>Bằng chứng:</b> Báo cáo đánh giá định kỳ nhà cung cấp."},
  {"section": "A.5 Tổ chức", "id": "A.5.23", "question": "(A.5.23) Khi NCC (ví dụ: nhà cung cấp Cloud) thay đổi dịch vụ, tổ chức có quy trình đánh giá rủi ro không?", "explanation": "<b>Ý nghĩa:</b> Đánh giá tác động khi đối tác (AWS, Azure...) có thay đổi lớn.<br><b>Bằng chứng:</b> Báo cáo đánh giá tác động thay đổi của NCC."},
  {"section": "A.5 Tổ chức", "id": "A.5.24", "question": "(A.5.24) Kế hoạch Quản lý Sự cố (1.5, 2.2) đã rõ ràng vai trò, trách nhiệm (Đội IRT) chưa?", "explanation": "<b>Ý nghĩa:</b> Khi 'cháy nhà' thì ai làm gì? Cần rõ ràng trước.<br><b>Bằng chứng:</b> Quyết định thành lập Đội ứng cứu sự cố (IRT)."},
  {"section": "A.5 Tổ chức", "id": "A.5.25", "question": "(A.5.25) Các sự kiện ATTT (events) có được đánh giá để xác định xem chúng có phải là sự cố (incidents) không? Ai chịu trách nhiệm?", "explanation": "<b>Ý nghĩa:</b> Phân loại để biết cái nào là cảnh báo giả, cái nào là sự cố thật cần xử lý.<br><b>Bằng chứng:</b> Quy trình phân loại mức độ sự cố (P1, P2, P3)."},
  {"section": "A.5 Tổ chức", "id": "A.5.26", "question": "(A.5.26) Đã xem Nhật ký Sự cố (3.3)? Các bước xử lý (Ngăn chặn, Tiêu diệt, Phục hồi) có được ghi lại không?", "explanation": "<b>Ý nghĩa:</b> Ghi chép lại quá trình xử lý để rút kinh nghiệm và làm bằng chứng.<br><b>Bằng chứng:</b> Sổ nhật ký sự cố (Incident Logbook/Ticket)."},
  {"section": "A.5 Tổ chức", "id": "A.5.27", "question": "(A.5.27) Các sự cố nghiêm trọng (trong 3.3) có được phân tích nguyên nhân gốc rễ (root cause) và rút bài học kinh nghiệm không?", "explanation": "<b>Ý nghĩa:</b> Tìm nguyên nhân gốc để không bị lại lỗi tương tự.<br><b>Bằng chứng:</b> Báo cáo phân tích sau sự cố (Post-Incident Review)."},
  {"section": "A.5 Tổ chức", "id": "A.5.28", "question": "(A.5.28) Tổ chức có quy trình thu thập và bảo quản bằng chứng kỹ thuật số (digital forensics) khi xảy ra sự cố không?", "explanation": "<b>Ý nghĩa:</b> Bảo vệ hiện trường số (dump RAM, copy ổ cứng) đúng cách để phục vụ điều tra.<br><b>Bằng chứng:</b> Quy trình điều tra số (Forensics)."},
  {"section": "A.5 Tổ chức", "id": "A.5.29", "question": "(A.5.29) Kế hoạch Kinh doanh Liên tục (BCP) có tích hợp các yêu cầu ATTT (bảo mật, toàn vẹn) khi hoạt động ở trạng thái dự phòng không?", "explanation": "<b>Ý nghĩa:</b> Chạy site dự phòng (DR) vẫn phải đảm bảo an toàn (vẫn cần firewall, antivirus...).<br><b>Bằng chứng:</b> Kế hoạch BCP/DRP có mục yêu cầu bảo mật."},
  {"section": "A.5 Tổ chức", "id": "A.5.30", "question": "(A.5.30) Đã thực hiện BIA, xác định RTO/RPO chưa? Đã có báo cáo diễn tập DRP/BCP (theo Chính sách 1.6) chưa?", "explanation": "<b>Ý nghĩa:</b> Biết hệ thống nào quan trọng nhất, bao lâu phải khôi phục xong. Phải diễn tập thử.<br><b>Bằng chứng:</b> Báo cáo BIA, Báo cáo kết quả diễn tập DRP."},
  {"section": "A.5 Tổ chức", "id": "A.5.31", "question": "(A.5.31) Tổ chức có danh sách các yêu cầu pháp lý (Luật An ninh mạng, Nghị định 13) và yêu cầu hợp đồng liên quan đến ATTT không?", "explanation": "<b>Ý nghĩa:</b> Tránh bị phạt vì không biết luật. Liệt kê hết các luật phải tuân thủ.<br><b>Bằng chứng:</b> Danh mục văn bản pháp quy ATTT áp dụng."},
  {"section": "A.5 Tổ chức", "id": "A.5.32", "question": "(A.5.32) Tổ chức có biện pháp bảo vệ IP (mã nguồn, tài liệu thiết kế) và tuân thủ bản quyền phần mềm không?", "explanation": "<b>Ý nghĩa:</b> Không dùng phần mềm lậu. Bảo vệ tài sản trí tuệ của mình.<br><b>Bằng chứng:</b> Chính sách bản quyền, danh sách license đã mua."},
  {"section": "A.5 Tổ chức", "id": "A.5.33", "question": "(A.5.33) Các hồ sơ quan trọng (log, hợp đồng) có được bảo vệ khỏi mất mát, sửa đổi và được lưu trữ đủ thời gian không?", "explanation": "<b>Ý nghĩa:</b> Log phải lưu đủ lâu (VD: 12 tháng theo luật) để phục vụ điều tra.<br><b>Bằng chứng:</b> Chính sách lưu trữ, cấu hình retention trên hệ thống log."},
  {"section": "A.5 Tổ chức", "id": "A.5.34", "question": "(A.5.34) Nếu tổ chức xử lý Thông tin Cá nhân (PII), các biện pháp nào được áp dụng để tuân thủ quy định (Nghị định 13)?", "explanation": "<b>Ý nghĩa:</b> Bảo vệ dữ liệu cá nhân của khách hàng/nhân viên. Cần có sự đồng ý khi thu thập.<br><b>Bằng chứng:</b> Chính sách bảo vệ dữ liệu cá nhân, các form lấy sự đồng ý (consent form)."},
  {"section": "A.5 Tổ chức", "id": "A.5.35", "question": "(A.5.35) Việc rà soát ISMS (Đánh giá nội bộ 9.2) có được thực hiện bởi những người khách quan, độc lập không?", "explanation": "<b>Ý nghĩa:</b> Đảm bảo tính công bằng. Tốt nhất là đánh giá chéo giữa các phòng ban hoặc thuê bên ngoài.<br><b>Bằng chứng:</b> Quyết định thành lập đoàn đánh giá nội bộ (đảm bảo không tự đánh giá mình)."},
  {"section": "A.5 Tổ chức", "id": "A.5.36", "question": "(A.5.36) Tổ chức có cơ chế nào để đảm bảo nhân viên tuân thủ các chính sách ATTT (ví dụ: kiểm tra, kỷ luật)?", "explanation": "<b>Ý nghĩa:</b> Chính sách ban hành ra phải được thực thi. Cần có 'cây gậy và củ cà rốt'.<br><b>Bằng chứng:</b> Quy định khen thưởng/kỷ luật liên quan ATTT."},
  {"section": "A.5 Tổ chức", "id": "A.5.37", "question": "(A.5.37) Các quy trình vận hành (ví dụ: backup, vá lỗi) có được tài liệu hóa và sẵn có cho người thực hiện không?", "explanation": "<b>Ý nghĩa:</b> Tránh phụ thuộc vào trí nhớ của một cá nhân. Mọi việc vận hành lặp lại cần có hướng dẫn (SOP).<br><b>Bằng chứng:</b> Các tài liệu hướng dẫn vận hành (SOP) cho IT/Sysadmin."},
  {"section": "A.6 Con người", "id": "A.6.1", "question": "(A.6.1) Quy trình HR có bao gồm việc kiểm tra lý lịch (screening) cho các vị trí nhạy cảm (IT, Tài chính) trước khi tuyển dụng không?", "explanation": "<b>Ý nghĩa:</b> Tránh tuyển 'sói vào nhà'. Cần kiểm tra xem ứng viên có tiền án tiền sự liên quan đến công nghệ/lừa đảo không.<br><b>Bằng chứng:</b> Quy trình tuyển dụng, hồ sơ check reference/background."},
  {"section": "A.6 Con người", "id": "A.6.2", "question": "(A.6.2) Hợp đồng lao động hoặc thỏa thuận có bao gồm các điều khoản về trách nhiệm ATTT của nhân viên không?", "explanation": "<b>Ý nghĩa:</b> Ràng buộc pháp lý ngay từ đầu. Nhân viên phải biết họ có trách nhiệm bảo mật.<br><b>Bằng chứng:</b> Hợp đồng lao động mẫu, bản cam kết bảo mật (NDA) nhân viên ký."},
  {"section": "A.6 Con người", "id": "A.6.3", "question": "(A.6.3) Đã có bằng chứng đào tạo nhận thức ATTT hàng năm (slide, danh sách tham dự)? (Giống 7.3)", "explanation": "<b>Ý nghĩa:</b> Nhắc lại kiến thức định kỳ vì các thủ đoạn lừa đảo luôn mới.<br><b>Bằng chứng:</b> Kế hoạch đào tạo năm, hồ sơ các lớp đã tổ chức."},
  {"section": "A.6 Con người", "id": "A.6.4", "question": "(A.6.4) Tổ chức có quy trình kỷ luật (trong Nội quy lao động) nếu nhân viên vi phạm chính sách ATTT không?", "explanation": "<b>Ý nghĩa:</b> Răn đe để đảm bảo tuân thủ.<br><b>Bằng chứng:</b> Nội quy lao động (có mục xử lý vi phạm ATTT)."},
  {"section": "A.6 Con người", "id": "A.6.5", "question": "(A.6.5) Quy trình nghỉ việc (Off-boarding) có bao gồm việc nhắc nhở/ràng buộc trách nhiệm bảo mật sau khi nghỉ không?", "explanation": "<b>Ý nghĩa:</b> Dù nghỉ rồi nhưng vẫn không được tiết lộ bí mật công ty cũ.<br><b>Bằng chứng:</b> Biên bản thanh lý hợp đồng có điều khoản bảo mật trọn đời/có thời hạn."},
  {"section": "A.6 Con người", "id": "A.6.6", "question": "(A.6.6) Nhân viên và nhà thầu có ký Thỏa thuận Bảo mật (NDA / Confidentiality Agreement) không?", "explanation": "<b>Ý nghĩa:</b> Văn bản pháp lý bắt buộc trước khi cho phép tiếp cận thông tin nhạy cảm.<br><b>Bằng chứng:</b> Các NDA đã ký được lưu trữ."},
  {"section": "A.6 Con người", "id": "A.6.7", "question": "(A.6.7) Đã có chính sách và các biện pháp kỹ thuật (VPN, MFA, mã hóa) cho nhân viên làm việc từ xa (Remote working) chưa?", "explanation": "<b>Ý nghĩa:</b> Làm ở nhà (WFH) rủi ro hơn ở công ty. Cần có kênh kết nối an toàn (VPN) và xác thực mạnh (MFA).<br><b>Bằng chứng:</b> Chính sách làm việc từ xa, cấu hình VPN/MFA."},
  {"section": "A.6 Con người", "id": "A.6.8", "question": "(A.6.8) Phỏng vấn nhân viên: Nếu nhận được email lạ, họ biết cách báo cáo sự cố (cho IT/Helpdesk) theo Quy trình 2.2 không?", "explanation": "<b>Ý nghĩa:</b> Kiểm tra xem việc đào tạo có hiệu quả không. Nhân viên phải biết nút 'Báo cáo Phishing' ở đâu.<br><b>Bằng chứng:</b> Kết quả phỏng vấn ngẫu nhiên, hoặc kết quả diễn tập phishing."},
  {"section": "A.7 Vật lý", "id": "A.7.1", "question": "(A.7.1) Vòng đai an ninh vật lý (cửa, tường, hàng rào) của văn phòng và phòng server có được xác định và bảo vệ không?", "explanation": "<b>Ý nghĩa:</b> Lớp bảo vệ đầu tiên. Ngăn người lạ đột nhập tự do.<br><b>Bằng chứng:</b> Sơ đồ bố trí mặt bằng, quan sát thực tế cửa ra vào, bảo vệ trực."},
  {"section": "A.7 Vật lý", "id": "A.7.2", "question": "(A.7.2) Quan sát: Việc ra vào các khu vực nhạy cảm (văn phòng, phòng server) có được kiểm soát không (thẻ từ, khóa)? Khách có được giám sát/đeo thẻ không?", "explanation": "<b>Ý nghĩa:</b> Kiểm soát ai được vào đâu. Khách đến phải có người kèm.<br><b>Bằng chứng:</b> Hệ thống kiểm soát ra vào (Access Control System), sổ nhật ký khách ra vào."},
  {"section": "A.7 Vật lý", "id": "A.7.3", "question": "(A.7.3) Văn phòng và phòng server có được bảo vệ (khóa cửa, tủ rack) khi không có người giám sát không?", "explanation": "<b>Ý nghĩa:</b> Tránh việc ai đó lẻn vào rút dây/cắm USB khi không có người.<br><b>Bằng chứng:</b> Quan sát thực tế các tủ rack có khóa không."},
  {"section": "A.7 Vật lý", "id": "A.7.4", "question": "(A.7.4) Quan sát: Có hệ thống giám sát (CCTV) tại các lối ra vào và khu vực nhạy cảm không? Log camera có được lưu trữ và bảo vệ không?", "explanation": "<b>Ý nghĩa:</b> Ghi lại hình ảnh để điều tra nếu có mất mát tài sản vật lý.<br><b>Bằng chứng:</b> Hệ thống camera, quy định thời gian lưu trữ video."},
  {"section": "A.7 Vật lý", "id": "A.7.5", "question": "(A.7.5) Phòng server có được bảo vệ khỏi các mối đe dọa môi trường không (cháy, ngập, nhiệt độ)? (Bằng chứng: bình chữa cháy, điều hòa, UPS)", "explanation": "<b>Ý nghĩa:</b> Đảm bảo thiết bị không bị hỏng do nóng, ẩm, cháy, mất điện.<br><b>Bằng chứng:</b> Hệ thống báo cháy/chữa cháy FM200, cảm biến nhiệt độ/độ ẩm, UPS/máy phát điện."},
  {"section": "A.7 Vật lý", "id": "A.7.6", "question": "(A.7.6) Các quy tắc làm việc tại khu vực an toàn (phòng server) có được định nghĩa và tuân thủ không (ví dụ: hạn chế mang thiết bị cá nhân)?", "explanation": "<b>Ý nghĩa:</b> Phòng server không phải cái kho. Cần quy định rõ ai được vào làm gì.<br><b>Bằng chứng:</b> Nội quy phòng máy chủ (dán trước cửa)."},
  {"section": "A.7 Vật lý", "id": "A.7.7", "question": "(A.7.7) Quan sát: Nhân viên có tuân thủ chính sách \"Bàn làm việc sạch\" (không để tài liệu nhạy cảm) và \"Màn hình sạch\" (khóa máy tính khi rời đi) không?", "explanation": "<b>Ý nghĩa:</b> Tránh lộ thông tin cho người đi ngang qua (shoulder surfing).<br><b>Bằng chứng:</b> Quan sát thực tế văn phòng giờ nghỉ trưa/cuối giờ."},
  {"section": "A.7 Vật lý", "id": "A.7.8", "question": "(A.7.8) Thiết bị (máy chủ, switch) có được đặt ở vị trí an toàn, giảm thiểu rủi ro bị nhìn trộm hoặc hư hỏng không?", "explanation": "<b>Ý nghĩa:</b> Không đặt màn hình máy chủ hướng ra cửa sổ công cộng.<br><b>Bằng chứng:</b> Quan sát vị trí lắp đặt thiết bị."},
  {"section": "A.7 Vật lý", "id": "A.7.9", "question": "(A.7.9) Các biện pháp nào được áp dụng để bảo vệ tài sản (ví dụ: laptop) khi nhân viên mang ra khỏi văn phòng (làm việc từ xa, công tác)?", "explanation": "<b>Ý nghĩa:</b> Laptop mang ra quán cafe rất dễ mất. Cần mã hóa ổ cứng (Bitlocker) để mất máy nhưng không mất dữ liệu.<br><b>Bằng chứng:</b> Chính sách sử dụng thiết bị di động, cấu hình mã hóa."},
  {"section": "A.7 Vật lý", "id": "A.7.10", "question": "(A.7.10) Các thiết bị lưu trữ (USB, ổ cứng hỏng) có được quản lý (kiểm soát, cấp phát) và hủy bỏ an toàn (xóa dữ liệu, phá hủy vật lý) khi không còn sử dụng không?", "explanation": "<b>Ý nghĩa:</b> Ổ cứng hỏng vứt sọt rác vẫn có thể bị khôi phục dữ liệu. Cần hủy vật lý (khoan, đập nát).<br><b>Bằng chứng:</b> Biên bản hủy tài sản, quy trình hủy dữ liệu."},
  {"section": "A.7 Vật lý", "id": "A.7.11", "question": "(A.7.11) Các hệ thống hỗ trợ (điện, điều hòa, mạng) cho phòng server có được bảo vệ, dự phòng (UPS, máy nổ) và bảo trì định kỳ không?", "explanation": "<b>Ý nghĩa:</b> Đảm bảo tính liên tục (Availability). Mất điện phải có UPS gánh trong lúc chờ máy nổ.<br><b>Bằng chứng:</b> Hồ sơ bảo trì hệ thống điện/lạnh, nhật ký chạy thử máy phát."},
  {"section": "A.7 Vật lý", "id": "A.7.12", "question": "(A.7.12) Hệ thống cáp (mạng, điện) có được bảo vệ khỏi việc bị can thiệp hoặc hư hỏng vật lý không (ví dụ: đi trong máng cáp, ống gen)?", "explanation": "<b>Ý nghĩa:</b> Tránh chuột cắn hoặc ai đó cắt trộm/nghe lén. Cáp nên đi ngầm hoặc trong ống bảo vệ.<br><b>Bằng chứng:</b> Quan sát thực tế hệ thống máng cáp."},
  {"section": "A.7 Vật lý", "id": "A.7.13", "question": "(A.7.13) Thiết bị (máy chủ, UPS) có được bảo trì định kỳ theo lịch của nhà cung cấp không? Hồ sơ bảo trì có được lưu lại không?", "explanation": "<b>Ý nghĩa:</b> 'Của bền tại người'. Bảo trì để phát hiện sớm nguy cơ hỏng hóc.<br><b>Bằng chứng:</b> Kế hoạch và biên bản bảo trì thiết bị."},
  {"section": "A.7 Vật lý", "id": "A.7.14", "question": "(A.7.14) Khi thanh lý hoặc tái sử dụng thiết bị (laptop, máy chủ), tổ chức có đảm bảo mọi dữ liệu nhạy cảm đã được xóa an toàn không?", "explanation": "<b>Ý nghĩa:</b> Trước khi bán máy cũ hoặc chuyển cho nhân viên khác dùng, phải wipe sạch dữ liệu cũ.<br><b>Bằng chứng:</b> Quy trình thanh lý tài sản, biên bản xóa dữ liệu."},
  {"section": "A.8 Công nghệ", "id": "A.8.1", "question": "(A.8.1) Quan sát: Thiết bị đầu cuối (laptop, PC) có được bảo vệ không (cài Antivirus, bật mã hóa ổ cứng, chính sách màn hình khóa tự động)?", "explanation": "<b>Ý nghĩa:</b> Bảo vệ 'cửa ngõ' mà nhân viên dùng hàng ngày.<br><b>Bằng chứng:</b> Màn hình Antivirus trên máy nhân viên, policy trên AD (Group Policy)."},
  {"section": "A.8 Công nghệ", "id": "A.8.2", "question": "(A.8.2) Quyền truy cập đặc quyền (admin, root) có bị hạn chế, giám sát và chỉ cấp khi thật sự cần thiết không?", "explanation": "<b>Ý nghĩa:</b> Tài khoản Admin là mục tiêu số 1 của hacker. Cần dùng PAM hoặc hạn chế tối đa số người biết password admin.<br><b>Bằng chứng:</b> Danh sách tài khoản đặc quyền, log sử dụng các tài khoản này."},
  {"section": "A.8 Công nghệ", "id": "A.8.3", "question": "(A.8.3) Việc truy cập thông tin (ví dụ: ổ đĩa dùng chung, CSDL) có được phân quyền (restriction) dựa trên vai trò, chức năng không?", "explanation": "<b>Ý nghĩa:</b> Phòng nào chỉ xem dữ liệu phòng đó. Không share 'Everyone - Full Control'.<br><b>Bằng chứng:</b> Cấu hình phân quyền NTFS trên File Server, phân quyền trong Database."},
  {"section": "A.8 Công nghệ", "id": "A.8.4", "question": "(A.8.4) (Nếu có) Quyền truy cập mã nguồn (source code) có được kiểm soát chặt chẽ (phân quyền trên Git, SVN) không?", "explanation": "<b>Ý nghĩa:</b> Source code là tài sản lõi của công ty phần mềm. Tránh lộ lọt hoặc bị nhân viên cũ sửa trộm.<br><b>Bằng chứng:</b> Cấu hình phân quyền trên GitLab/GitHub/Bitbucket."},
  {"section": "A.8 Công nghệ", "id": "A.8.5", "question": "(A.8.5) Hệ thống có cung cấp cơ chế xác thực an toàn không (ví dụ: không truyền mật khẩu clear text, có MFA)?", "explanation": "<b>Ý nghĩa:</b> Đăng nhập phải an toàn. Bắt buộc dùng HTTPS và khuyến nghị MFA cho các hệ thống quan trọng.<br><b>Bằng chứng:</b> Cấu hình hệ thống xác thực (SSO, LDAP, MFA)."},
  {"section": "A.8 Công nghệ", "id": "A.8.6", "question": "(A.8.6) Tổ chức có giám sát dung lượng (capacity) của các hệ thống quan trọng (CPU, RAM, disk, bandwidth) để dự báo và mở rộng kịp thời không?", "explanation": "<b>Ý nghĩa:</b> Tránh sập hệ thống do đầy ổ cứng hoặc quá tải CPU.<br><b>Bằng chứng:</b> Các công cụ giám sát (Zabbix, Prometheus, SolarWinds) và báo cáo capacity."},
  {"section": "A.8 Công nghệ", "id": "A.8.7", "question": "(A.8.7) Tổ chức có giải pháp bảo vệ chống mã độc (Antivirus/Antimalware) trên máy chủ, máy trạm không? Giải pháp này có được cập nhật thường xuyên không?", "explanation": "<b>Ý nghĩa:</b> Lớp bảo vệ cơ bản nhất chống virus/ransomware.<br><b>Bằng chứng:</b> Dashboard quản lý Antivirus tập trung, kiểm tra ngày cập nhật signature."},
  {"section": "A.8 Công nghệ", "id": "A.8.8", "question": "(A.8.8) Đã có báo cáo quét lỗ hổng (Vulnerability Scan) gần nhất chưa? Các lỗ hổng \"Nghiêm trọng\" (Critical) đã được xử lý (vá lỗi) chưa?", "explanation": "<b>Ý nghĩa:</b> Chủ động tìm lỗi trước khi hacker tìm thấy. Quan trọng là tìm xong phải vá.<br><b>Bằng chứng:</b> Báo cáo scan từ Nessus/OpenVAS/Qualys và ticket theo dõi việc vá lỗi."},
  {"section": "A.8 Công nghệ", "id": "A.8.9", "question": "(A.8.9) Tổ chức có áp dụng cấu hình an toàn (hardening) cho các hệ thống mới triển khai (tắt dịch vụ/cổng không cần thiết) không? (Xem Chính sách 1.9)", "explanation": "<b>Ý nghĩa:</b> Không để cấu hình mặc định (default) vì rất dễ bị hack. Phải 'cứng hóa' (hardening) trước khi go-live.<br><b>Bằng chứng:</b> Hardening checklist cho OS/Database, kết quả scan compliance."},
  {"section": "A.8 Công nghệ", "id": "A.8.10", "question": "(A.8.10) Khi dữ liệu không còn cần thiết, tổ chức có quy trình và công cụ để xóa an toàn (secure deletion) (ví dụ: ghi đè, degauss) không?", "explanation": "<b>Ý nghĩa:</b> 'Delete' thông thường vẫn khôi phục được. Cần xóa an toàn (ghi đè nhiều lần) đối với dữ liệu nhạy cảm.<br><b>Bằng chứng:</b> Công cụ xóa dữ liệu an toàn, quy trình hủy dữ liệu số."},
  {"section": "A.8 Công nghệ", "id": "A.8.11", "question": "(A.8.11) (Nếu có) Tổ chức có sử dụng kỹ thuật che giấu dữ liệu (data masking) khi sử dụng dữ liệu thật (production data) cho môi trường thử nghiệm (test) không?", "explanation": "<b>Ý nghĩa:</b> Dev không cần biết số thẻ tín dụng thật của khách hàng để test. Cần làm mờ/ẩn đi.<br><b>Bằng chứng:</b> Quy trình tạo dữ liệu test, các script/công cụ masking."},
  {"section": "A.8 Công nghệ", "id": "A.8.12", "question": "(A.8.12) Tổ chức có các biện pháp ngăn chặn rò rỉ dữ liệu (DLP) không (ví dụ: chặn USB, giám sát email, DLP gateway)?", "explanation": "<b>Ý nghĩa:</b> Ngăn chặn nhân viên (vô tình hoặc cố ý) gửi dữ liệu mật ra ngoài.<br><b>Bằng chứng:</b> Cấu hình giải pháp DLP, các quy định chặn cổng USB."},
  {"section": "A.8 Công nghệ", "id": "A.8.13", "question": "(A.8.13) Đã có log sao lưu (backup) thành công của các hệ thống quan trọng (từ đêm qua) chưa? (Xem Chính sách 1.3)", "explanation": "<b>Ý nghĩa:</b> Cứu cánh cuối cùng khi bị ransomware. Backup phải thành công và phải test khôi phục (restore) định kỳ.<br><b>Bằng chứng:</b> Log backup hàng ngày, biên bản test restore định kỳ."},
  {"section": "A.8 Công nghệ", "id": "A.8.14", "question": "(A.8.14) Các biện pháp nào (ví dụ: HA, clustering, load balancing) được sử dụng để đảm bảo tính sẵn sàng (availability) của thông tin/dịch vụ?", "explanation": "<b>Ý nghĩa:</b> Một máy chủ chết thì dịch vụ vẫn phải chạy. Cần có dự phòng nóng (HA).<br><b>Bằng chứng:</b> Sơ đồ kiến trúc hệ thống (thể hiện tính dự phòng), cấu hình Load Balancer."},
  {"section": "A.8 Công nghệ", "id": "A.8.15", "question": "(A.8.15) Các hệ thống quan trọng (máy chủ, firewall, CSDL) có được bật ghi nhật ký (logging) các sự kiện quan trọng không? (Xem Chính sách 1.8)", "explanation": "<b>Ý nghĩa:</b> 'Hộp đen' của hệ thống. Phải ghi log để biết ai đã làm gì khi có sự cố.<br><b>Bằng chứng:</b> Cấu hình audit log trên OS, DB, Network device."},
  {"section": "A.8 Công nghệ", "id": "A.8.16", "question": "(A.8.16) Log có được thu thập tập trung (SIEM/Syslog) và rà soát định kỳ (hoặc tự động) để phát hiện bất thường không? Log có được bảo vệ khỏi sửa đổi không?", "explanation": "<b>Ý nghĩa:</b> Log nằm rải rác rất khó xem và dễ bị hacker xóa. Cần gom về một chỗ (SIEM) để phân tích và bảo vệ.<br><b>Bằng chứng:</b> Hệ thống SIEM/Syslog server, các rule cảnh báo."},
  {"section": "A.8 Công nghệ", "id": "A.8.17", "question": "(A.8.17) Tất cả các hệ thống trong phạm vi có được đồng bộ hóa thời gian (clock synchronization) với một nguồn chuẩn (NTP server) không?", "explanation": "<b>Ý nghĩa:</b> Để điều tra sự cố chính xác, mọi log phải cùng một mốc thời gian.<br><b>Bằng chứng:</b> Cấu hình NTP trên các thiết bị."},
  {"section": "A.8 Công nghệ", "id": "A.8.18", "question": "(A.8.18) Việc sử dụng các tiện ích đặc quyền (ví dụ: các công cụ admin, debug) có được kiểm soát và hạn chế không?", "explanation": "<b>Ý nghĩa:</b> Các công cụ mạnh có thể vượt qua các kiểm soát bảo mật thông thường. Chỉ admin mới được dùng.<br><b>Bằng chứng:</b> Danh sách phần mềm được phép (whitelist) cho từng nhóm người dùng."},
  {"section": "A.8 Công nghệ", "id": "A.8.19", "question": "(A.8.19) Việc cài đặt phần mềm trên hệ thống vận hành (production) có được kiểm soát (thông qua Quản lý Thay đổi) không? Người dùng có bị cấm tự ý cài đặt không?", "explanation": "<b>Ý nghĩa:</b> Production phải ổn định. Không được tùy tiện cài thêm phần mềm lạ.<br><b>Bằng chứng:</b> Quy định cài đặt phần mềm, cấu hình chặn quyền Admin local của user thường."},
  {"section": "A.8 Công nghệ", "id": "A.8.20", "question": "(A.8.20) Xem cấu hình Tường lửa (Firewall): Mạng có được phân đoạn (network segregation) thành các vùng (DMZ, LAN, Wifi, Server) không? (Xem Chính sách 1.9)", "explanation": "<b>Ý nghĩa:</b> Chia để trị. Máy tính nhân viên (LAN) nhiễm virus không được lây lan sang máy chủ (Server VLAN).<br><b>Bằng chứng:</b> Sơ đồ mạng (Network diagram), cấu hình VLAN/Firewall zone."},
  {"section": "A.8 Công nghệ", "id": "A.8.21", "question": "(A.8.21) Các dịch vụ mạng (network services) có được cấu hình an toàn, tắt các tính năng không cần thiết không?", "explanation": "<b>Ý nghĩa:</b> Nguyên tắc 'Least Functionality'. Chỉ bật những gì cần thiết (ví dụ: Web server thì chỉ mở port 80/443).<br><b>Bằng chứng:</b> Kết quả scan port (Nmap), cấu hình hardening thiết bị mạng."},
  {"section": "A.8 Công nghệ", "id": "A.8.22", "question": "(A.8.22) Việc lọc và kiểm soát luồng thông tin (traffic) giữa các phân đoạn mạng có được thực hiện (trên Firewall/Router) không?", "explanation": "<b>Ý nghĩa:</b> Dùng firewall policy để chặn các kết nối không được phép giữa các vùng mạng.<br><b>Bằng chứng:</b> Review rule firewall (ví dụ: cấm từ Wifi Guest truy cập vào LAN nội bộ)."},
  {"section": "A.8 Công nghệ", "id": "A.8.23", "question": "(A.8.23) Tổ chức có giải pháp lọc web (web filtering) để chặn truy cập đến các trang web độc hại/không phù hợp không? (Xem Chính sách 1.9)", "explanation": "<b>Ý nghĩa:</b> Ngăn nhân viên vào web đen, web chứa mã độc, hoặc upload dữ liệu lên web lạ.<br><b>Bằng chứng:</b> Cấu hình Web Proxy/Firewall Web Filter."},
  {"section": "A.8 Công nghệ", "id": "A.8.24", "question": "(A.8.24) Tổ chức có chính sách và biện pháp sử dụng mật mã (cryptography) để bảo vệ thông tin không (ví dụ: mã hóa ổ cứng, SSL/TLS, mã hóa backup)?", "explanation": "<b>Ý nghĩa:</b> Dùng mã hóa chuẩn (AES, RSA...) để bảo vệ tính bí mật. Cần quản lý key an toàn.<br><b>Bằng chứng:</b> Chính sách mã hóa, cấu hình SSL/TLS trên web server."},
  {"section": "A.8 Công nghệ", "id": "A.8.25", "question": "(A.8.25) (Nếu có) Quy trình phát triển phần mềm có tuân theo một vòng đời phát triển an toàn (secure development life cycle - SDLC) không?", "explanation": "<b>Ý nghĩa:</b> Bảo mật phải được đưa vào từ lúc thiết kế (Security by Design), không phải code xong mới test.<br><b>Bằng chứng:</b> Quy trình DevSecOps/SDLC, các tài liệu thiết kế an toàn."},
  {"section": "A.8 Công nghệ", "id": "A.8.26", "question": "(A.8.26) (Nếu có) Các yêu cầu ATTT (application security requirements) có được xác định và tích hợp vào quá trình phát triển không?", "explanation": "<b>Ý nghĩa:</b> Trước khi code, phải xác định app này cần bảo mật những gì (ví dụ: cần login 2 yếu tố, cần mã hóa DB).<br><b>Bằng chứng:</b> Tài liệu yêu cầu phần mềm (SRS) có mục Non-functional/Security requirements."},
  {"section": "A.8 Công nghệ", "id": "A.8.27", "question": "(A.8.27) (Nếu có) Các nguyên tắc kiến trúc và kỹ thuật an toàn có được áp dụng khi xây dựng hệ thống không?", "explanation": "<b>Ý nghĩa:</b> Xây nhà phải có móng vững. Áp dụng các mô hình chuẩn (ví dụ: Zero Trust, Defense in Depth).<br><b>Bằng chứng:</b> Tài liệu thiết kế kiến trúc hệ thống (HLD/LLD)."},
  {"section": "A.8 Công nghệ", "id": "A.8.28", "question": "(A.8.28) (Nếu có) Lập trình viên có được đào tạo và áp dụng các nguyên tắc lập trình an toàn (secure coding) (ví dụ: OWASP Top 10) không?", "explanation": "<b>Ý nghĩa:</b> Coder phải biết tránh các lỗi cơ bản như SQL Injection, XSS.<br><b>Bằng chứng:</b> Chứng chỉ đào tạo Secure Coding, các guideline lập trình nội bộ."},
  {"section": "A.8 Công nghệ", "id": "A.8.29", "question": "(A.8.29) (Nếu có) Việc kiểm thử an toàn (security testing, ví dụ: VAPT, SAST/DAST) có được thực hiện trước khi triển khai (go-live) không?", "explanation": "<b>Ý nghĩa:</b> Test kỹ trước khi tung ra thị trường. Cần cả scan tự động (SAST/DAST) và pentest thủ công.<br><b>Bằng chứng:</b> Báo cáo Pentest, báo cáo scan code trước khi go-live."},
  {"section": "A.8 Công nghệ", "id": "A.8.30", "question": "(A.8.30) (Nếu có) Nếu thuê ngoài phát triển phần mềm, tổ chức có các biện pháp kiểm soát ATTT (hợp đồng, rà soát code) không?", "explanation": "<b>Ý nghĩa:</b> Code thuê ngoài thường nhiều lỗi bảo mật. Cần kiểm soát chặt đầu vào.<br><b>Bằng chứng:</b> Hợp đồng outsource có điều khoản bảo mật, biên bản review code khi nhận bàn giao."},
  {"section": "A.8 Công nghệ", "id": "A.8.31", "question": "(A.8.31) (Nếu có) Môi trường Phát triển (Dev), Thử nghiệm (Test) và Vận hành (Production) có được tách biệt (segregation) không?", "explanation": "<b>Ý nghĩa:</b> Không để dev sửa trực tiếp trên production. Môi trường test bị hack không được ảnh hưởng đến môi trường thật.<br><b>Bằng chứng:</b> Kiến trúc mạng tách biệt các môi trường, quy trình deploy code."},
  {"section": "A.8 Công nghệ", "id": "A.8.32", "question": "(A.8.32) Đã có bằng chứng (ticket, RFC) cho thấy các thay đổi (cấu hình, phần mềm) được phê duyệt, kiểm tra (theo QT 2.6) trước khi triển khai không?", "explanation": "<b>Ý nghĩa:</b> Kiểm soát chặt chẽ việc deploy để tránh downtime hoặc đưa lỗi mới vào hệ thống.<br><b>Bằng chứng:</b> Các ticket Change Management (RFC) đã được phê duyệt."},
  {"section": "A.8 Công nghệ", "id": "A.8.33", "question": "(A.8.33) (Nếu có) Dữ liệu thử nghiệm (test information) có được bảo vệ và lựa chọn cẩn thận (tránh dùng dữ liệu PII thật) không?", "explanation": "<b>Ý nghĩa:</b> Giống control 8.11. Tránh dùng dữ liệu thật của khách hàng để test.<br><b>Bằng chứng:</b> Quy trình quản lý dữ liệu test."},
  {"section": "A.8 Công nghệ", "id": "A.8.34", "question": "(A.8.34) Các hoạt động đánh giá (audit tests, pentest) có được lập kế hoạch và giám sát để giảm thiểu rủi ro gián đoạn hệ thống vận hành không?", "explanation": "<b>Ý nghĩa:</b> Đừng để việc pentest làm sập hệ thống thật. Cần thỏa thuận rõ thời gian và phạm vi test.<br><b>Bằng chứng:</b> Kế hoạch đánh giá/pentest đã được phê duyệt, quy định Rules of Engagement (RoE)."}
];

let currentQuestionIndex = 0, clientName = "", auditResults = [], isDirty = false, sections = [];
const els = {
    clientNameInput: document.getElementById('clientName'), startButton: document.getElementById('startButton'),
    clientNameDisplay: document.getElementById('clientNameDisplay'), saveReportButton: document.getElementById('saveReportButton'),
    restartButton: document.getElementById('restartButton'), sectionList: document.getElementById('sectionList'),
    progressText: document.getElementById('progressText'), progressBar: document.getElementById('progressBar'),
    controlSection: document.getElementById('controlSection'), controlId: document.getElementById('controlId'),
    controlQuestion: document.getElementById('controlQuestion'), controlStatus: document.getElementById('controlStatus'),
    controlEvidenceUpload: document.getElementById('controlEvidenceUpload'), evidenceList: document.getElementById('evidenceList'),
    uploadLoading: document.getElementById('uploadLoading'), controlNote: document.getElementById('controlNote'),
    prevButton: document.getElementById('prevButton'), nextButton: document.getElementById('nextButton'),
    controlCounter: document.getElementById('controlCounter'), reportFileName: document.getElementById('reportFileName')
};
const screens = { setup: document.getElementById('screen-setup'), audit: document.getElementById('screen-audit'), done: document.getElementById('screen-done') };

window.addEventListener('beforeunload', (e) => { if (isDirty) { e.preventDefault(); e.returnValue = ''; } });
function showScreen(sid) { Object.values(screens).forEach(s => s.classList.remove('active')); screens[sid].classList.add('active'); }
function populateSidebar() {
    sections = [...new Set(CHECKLIST_DATA.map(item => item.section))]; els.sectionList.innerHTML = '';
    sections.forEach(sec => {
        const li = document.createElement('li'), btn = document.createElement('button');
        btn.className = "w-full text-left p-3 rounded-lg font-medium text-slate-600 hover:bg-emerald-50 hover:text-emerald-700 transition duration-150";
        btn.textContent = sec; btn.onclick = () => jumpToSection(sec); li.appendChild(btn); els.sectionList.appendChild(li);
    });
}
function updateSidebarHighlight(curr) { els.sectionList.querySelectorAll('button').forEach(b => b.classList.toggle('active', b.textContent === curr)); }
function jumpToSection(name) { saveCurrentAnswer(); currentQuestionIndex = CHECKLIST_DATA.findIndex(i => i.section === name); loadQuestion(currentQuestionIndex); updateProgress(); }
function startAudit() {
    clientName = els.clientNameInput.value.trim(); if (clientName === "") return alert("Vui lòng nhập tên khách hàng.");
    els.clientNameDisplay.textContent = clientName;
    auditResults = CHECKLIST_DATA.map(item => ({ ...item, status: "Bỏ qua", note: "", evidence_files: [] }));
    populateSidebar(); currentQuestionIndex = 0; loadQuestion(0); updateProgress(); showScreen('audit'); isDirty = true;
}
function renderEvidenceList() {
    const files = auditResults[currentQuestionIndex].evidence_files || []; els.evidenceList.innerHTML = '';
    if (files.length === 0) { els.evidenceList.innerHTML = '<div class="text-sm text-slate-400 italic pl-2">Chưa có file bằng chứng.</div>'; return; }
    files.forEach((url, index) => {
        const div = document.createElement('div'); div.className = 'flex items-center justify-between p-2.5 bg-emerald-50 rounded-lg border border-emerald-100 group hover:border-emerald-300 transition';
        div.innerHTML = `<a href="${url}" target="_blank" class="text-sm text-emerald-700 hover:underline truncate flex-1 mr-3 font-medium" title="${url.split('/').pop()}">📄 ${url.split('/').pop()}</a><button type="button" class="text-slate-400 hover:text-red-500 focus:outline-none p-1.5 rounded-full hover:bg-red-50 transition" title="Xóa file này" onclick="removeEvidenceFile(${index})"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" /></svg></button>`;
        els.evidenceList.appendChild(div);
    });
}
window.removeEvidenceFile = function(fileIndex) { if (confirm('Bạn chắc chắn muốn xóa file này?')) { auditResults[currentQuestionIndex].evidence_files.splice(fileIndex, 1); renderEvidenceList(); }};
function loadQuestion(idx) {
    const item = CHECKLIST_DATA[idx], res = auditResults[idx];
    els.controlSection.textContent = item.section; els.controlId.textContent = item.id; els.controlQuestion.textContent = item.question; els.controlStatus.value = res.status;
    renderEvidenceList(); els.controlEvidenceUpload.value = null; els.controlNote.value = res.note; els.controlCounter.textContent = `${idx + 1} / ${CHECKLIST_DATA.length}`;
    updateSidebarHighlight(item.section);
    els.prevButton.disabled = (idx === 0); els.prevButton.classList.toggle('opacity-50', idx === 0); els.prevButton.classList.toggle('cursor-not-allowed', idx === 0);
    const isLast = idx === CHECKLIST_DATA.length - 1;
    els.nextButton.innerHTML = isLast ? `Hoàn thành <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>` : `Tiếp theo <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" /></svg>`;
    els.nextButton.classList.toggle('bg-emerald-800', isLast); els.nextButton.classList.toggle('hover:bg-emerald-900', isLast);
    els.nextButton.classList.toggle('bg-emerald-600', !isLast); els.nextButton.classList.toggle('hover:bg-emerald-700', !isLast);
    const expArea = document.getElementById('explanationArea'), expContent = document.getElementById('explanationContent');
    // Tự động đóng hướng dẫn khi chuyển câu
    if (expArea.querySelector('details')) expArea.querySelector('details').removeAttribute('open');
    if (item.explanation) { expArea.classList.remove('hidden'); expContent.innerHTML = item.explanation; } else { expArea.classList.add('hidden'); }
}
async function handleFileUpload(e) {
    const files = e.target.files; if (!files || files.length === 0) return;
    els.uploadLoading.classList.remove('hidden');
    const safeName = clientName ? clientName.trim().replace(/[^a-z0-9]/gi, '-').toLowerCase() : 'unknown';
    for (let i = 0; i < files.length; i++) {
        const formData = new FormData(); formData.append('file', files[i]);
        try {
            const res = await fetch('/api/upload', { method: 'POST', headers: { 'x-client-name': safeName }, body: formData });
            if (!res.ok) throw new Error((await res.json()).error || 'Upload thất bại.');
            const data = await res.json(); auditResults[currentQuestionIndex].evidence_files.push(data.url);
        } catch (err) { console.error(err); alert(`Lỗi khi tải file ${files[i].name}: ${err.message}`); }
    }
    els.uploadLoading.classList.add('hidden'); renderEvidenceList(); e.target.value = null;
}
function saveCurrentAnswer() { if(auditResults[currentQuestionIndex]) { auditResults[currentQuestionIndex].status = els.controlStatus.value; auditResults[currentQuestionIndex].note = els.controlNote.value.trim(); } }
function nextQuestion() { saveCurrentAnswer(); if (currentQuestionIndex < CHECKLIST_DATA.length - 1) { currentQuestionIndex++; loadQuestion(currentQuestionIndex); } else { generateReport(); } updateProgress(); }
function prevQuestion() { saveCurrentAnswer(); if (currentQuestionIndex > 0) { currentQuestionIndex--; loadQuestion(currentQuestionIndex); } updateProgress(); }
function updateProgress() { const answered = auditResults.filter(r => r.status !== "Bỏ qua").length; els.progressText.textContent = `${answered}/${CHECKLIST_DATA.length}`; els.progressBar.style.setProperty('--progress-width', `${(answered / CHECKLIST_DATA.length) * 100}%`); }

function generateReport() {
		 
    if (!confirm("Bạn có chắc chắn muốn hoàn thành và xuất báo cáo không?")) return;
    saveCurrentAnswer(); updateProgress();
    const audited = auditResults.filter(r => r.status !== "Bỏ qua").length, compliant = auditResults.filter(r => r.status === "Tuân thủ").length, nc = auditResults.filter(r => r.status === "Không Tuân thủ (NC)").length, na = auditResults.filter(r => r.status === "Không Áp dụng").length, denom = audited - na, score = denom > 0 ? Math.round((compliant / denom) * 100) : 0;
    let evalText = "", evalColor = ""; if (score >= 90) { evalText = "Hệ thống vận hành TỐT. Rủi ro thấp."; evalColor = "text-emerald-600"; } else if (score >= 70) { evalText = "Hệ thống ĐẠT YÊU CẦU cơ bản."; evalColor = "text-amber-600"; } else { evalText = "CẦN CẢI THIỆN GẤP."; evalColor = "text-red-600"; }
    const sectionStats = {}; auditResults.forEach(r => { if (!sectionStats[r.section]) sectionStats[r.section] = { compliant: 0, nc: 0 }; if (r.status === "Tuân thủ") sectionStats[r.section].compliant++; if (r.status === "Không Tuân thủ (NC)") sectionStats[r.section].nc++; });
    const chartLabels = Object.keys(sectionStats), chartDataNC = chartLabels.map(s => sectionStats[s].nc), chartDataC = chartLabels.map(s => sectionStats[s].compliant);
    const now = new Date(), reportDate = `${now.getDate()}/${now.getMonth()+1}/${now.getFullYear()}`, safeName = clientName.replace(/[^a-z0-9]/gi, '_').toLowerCase();
    // Template báo cáo với fix lỗi in ấn A4 landscape và font-size SVG
    const reportHTML = `<!DOCTYPE html><html lang="vi"><head><meta charset="UTF-8"><title>Báo cáo ISO 27001 - ${clientName}</title><script src="https://cdn.tailwindcss.com"><\/script><script src="https://cdn.jsdelivr.net/npm/chart.js"><\/script><style>@media print{@page{size:A4 landscape;margin:10mm}body{margin:0;padding:0;background:white}.container{width:100%!important;max-width:none!important;box-shadow:none!important;margin:0!important;padding:0!important}.no-print{display:none!important}.page-break{page-break-before:always}h2,h3,.bg-slate-50,tr{break-inside:avoid}canvas{max-width:100%!important;max-height:100%!important}}body{font-family:'Inter',sans-serif;background:#f8fafc}.container{max-width:1000px;margin:0 auto;background:white;padding:40px;box-shadow:0 10px 30px -10px rgba(0,0,0,.1)}</style></head><body class="p-0 md:p-10"><div class="container mx-auto my-10 rounded-xl" id="report-container"><div class="flex justify-between items-center border-b-2 border-slate-800 pb-6 mb-8"><div><h1 class="text-4xl font-extrabold text-slate-800 uppercase">Báo cáo Đánh giá</h1><div class="text-xl font-semibold text-emerald-600 mt-1">ISO/IEC 27001:2022</div></div><div class="text-right"><div class="text-slate-500 font-medium">Tổ chức được đánh giá</div><div class="text-2xl font-bold text-slate-800">${clientName}</div><div class="text-slate-400 text-sm mt-1">Ngày: ${reportDate}</div></div></div><div class="bg-slate-50 rounded-2xl p-8 mb-10 border border-slate-200"><h2 class="text-2xl font-bold text-slate-800 mb-6 flex items-center"><span class="bg-emerald-600 w-2 h-8 mr-3 rounded-full"></span>1. Tóm tắt Tổng quan</h2><div class="grid grid-cols-1 md:grid-cols-3 gap-8"><div class="flex flex-col items-center justify-center p-6 bg-white rounded-xl shadow-sm border border-slate-100"><div class="relative w-40 h-40"><svg class="w-full h-full" viewBox="0 0 36 36"><path d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="#e2e8f0" stroke-width="3"/><path d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="${score >= 70 ? '#059669' : '#dc2626'}" stroke-width="3" stroke-dasharray="${score}, 100"/><text x="18" y="20.5" font-size="8" font-weight="bold" text-anchor="middle" fill="${score >= 70 ? '#059669' : '#dc2626'}">${score}%</text></svg></div><div class="mt-4 text-lg font-bold text-slate-700">Điểm Tuân thủ</div></div><div class="md:col-span-2 flex flex-col justify-center space-y-6"><div class="grid grid-cols-3 gap-4 text-center"><div class="p-4 bg-emerald-50 rounded-xl border border-emerald-100"><div class="text-3xl font-extrabold text-emerald-600">${compliant}</div><div class="text-sm font-semibold text-emerald-800 mt-1">Tuân thủ</div></div><div class="p-4 bg-red-50 rounded-xl border border-red-100"><div class="text-3xl font-extrabold text-red-600">${nc}</div><div class="text-sm font-semibold text-red-800 mt-1">Không tuân thủ</div></div><div class="p-4 bg-slate-100 rounded-xl border border-slate-200"><div class="text-3xl font-extrabold text-slate-600">${na}</div><div class="text-sm font-semibold text-slate-700 mt-1">Không áp dụng</div></div></div><div class="p-5 bg-white rounded-xl border-l-4 ${score >= 70 ? 'border-emerald-500' : 'border-red-500'} shadow-sm"><div class="text-sm font-bold text-slate-400 uppercase mb-1">Đánh giá chuyên gia</div><div class="text-lg font-bold ${evalColor}">${evalText}</div></div></div></div></div><div class="mb-12"><h2 class="text-2xl font-bold text-slate-800 mb-6 flex items-center"><span class="bg-emerald-600 w-2 h-8 mr-3 rounded-full"></span>2. Phân tích theo Lĩnh vực</h2><div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200" style="height:400px"><canvas id="domainChart"></canvas></div></div><div class="page-break"></div><div class="mb-12 mt-10"><h2 class="text-2xl font-bold text-slate-800 mb-6 flex items-center text-red-700"><span class="bg-red-600 w-2 h-8 mr-3 rounded-full"></span>3. Các Phát hiện Quan trọng (NC)</h2>${nc===0?'<div class="p-5 bg-emerald-50 text-emerald-700 rounded-xl font-medium border border-emerald-200">Tuyệt vời! Không phát hiện điểm không phù hợp (NC).</div>':`<table class="w-full text-sm text-left text-slate-700 border-collapse"><thead class="text-xs text-white uppercase bg-red-700"><tr><th class="px-4 py-3 rounded-tl-lg">ID</th><th class="px-4 py-3">Nội dung</th><th class="px-4 py-3 rounded-tr-lg">Chi tiết lỗi</th></tr></thead><tbody>${auditResults.filter(r=>r.status==="Không Tuân thủ (NC)").map(r=>`<tr class="border-b border-slate-200 bg-red-50/30"><td class="px-4 py-4 font-bold text-red-700 align-top">${r.id}</td><td class="px-4 py-4 font-medium align-top">${r.question}</td><td class="px-4 py-4 text-slate-600 align-top">${r.note||'Chưa có ghi chú.'}</td></tr>`).join('')}</tbody></table>`}</div><div><h2 class="text-2xl font-bold text-slate-800 mb-6 flex items-center"><span class="bg-emerald-600 w-2 h-8 mr-3 rounded-full"></span>4. Chi tiết Kết quả</h2><div class="overflow-x-auto rounded-xl border border-slate-200"><table class="w-full text-sm text-left text-slate-700"><thead class="text-xs text-slate-700 uppercase bg-slate-100"><tr><th class="px-4 py-3">ID</th><th class="px-4 py-3">Trạng thái</th><th class="px-4 py-3 w-1/3">Ghi chú</th><th class="px-4 py-3">File Bằng chứng</th></tr></thead><tbody class="divide-y divide-slate-200">${auditResults.filter(r=>r.status!=="Bỏ qua").map(r=>`<tr class="bg-white hover:bg-slate-50"><td class="px-4 py-4 font-medium align-top">${r.id}</td><td class="px-4 py-4 align-top"><span class="px-3 py-1 rounded-full text-xs font-bold ${r.status==='Tuân thủ'?'bg-emerald-100 text-emerald-800':r.status==='Không Tuân thủ (NC)'?'bg-red-100 text-red-800':'bg-slate-100 text-slate-800'}">${r.status}</span></td><td class="px-4 py-4 align-top text-slate-600 whitespace-pre-wrap">${r.note}</td><td class="px-4 py-4 align-top">${r.evidence_files&&r.evidence_files.length>0?r.evidence_files.map(u=>`<a href="${u}" target="_blank" class="text-blue-600 hover:underline block mb-1 truncate max-w-xs">📎 ${u.split('/').pop()}</a>`).join('<br>'):'<span class="text-slate-400 italic">-</span>'}</td></tr>`).join('')}</tbody></table></div></div></div><div class="fixed bottom-8 right-8 no-print"><button onclick="window.print()" class="bg-blue-600 text-white p-4 rounded-full shadow-xl hover:bg-blue-700 transition flex items-center font-bold"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"/></svg>IN BÁO CÁO (PDF)</button></div><script>document.addEventListener('DOMContentLoaded',()=>{new Chart(document.getElementById('domainChart').getContext('2d'),{type:'bar',data:{labels:${JSON.stringify(chartLabels)},datasets:[{label:'Tuân thủ',data:${JSON.stringify(chartDataC)},backgroundColor:'#059669'},{label:'Không tuân thủ (NC)',data:${JSON.stringify(chartDataNC)},backgroundColor:'#dc2626'}]},options:{responsive:true,maintainAspectRatio:false,scales:{x:{stacked:true},y:{stacked:true,beginAtZero:true}},plugins:{legend:{position:'top'}}}})});<\/script></body></html>`;
    saveAs(new Blob([reportHTML], { type: "text/html;charset=utf-8" }), `Bao_cao_ISO27001_${safeName}_${now.toISOString().slice(0,10)}.html`);
    els.reportFileName.textContent = `Bao_cao_ISO27001_${safeName}_${now.toISOString().slice(0,10)}.html`; showScreen('done'); isDirty = false;
				 
																										
	 
}

document.addEventListener('DOMContentLoaded', () => {
    els.startButton.addEventListener('click', startAudit);
    els.controlStatus.addEventListener('change', () => { saveCurrentAnswer(); updateProgress(); });
    els.prevButton.addEventListener('click', prevQuestion);
    els.nextButton.addEventListener('click', nextQuestion);
    els.saveReportButton.addEventListener('click', generateReport);
    els.controlEvidenceUpload.addEventListener('change', handleFileUpload);
    els.restartButton.addEventListener('click', () => { els.clientNameInput.value = ""; showScreen('setup'); });
});
</script>
</body>
</html>