<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Audit Tool - ISO 27001:2022</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        /* Ẩn/hiện các màn hình */
        .screen { display: none; }
        .screen.active { display: block; }
        /* Cố định thanh progress */
        .progress-bar {
            width: var(--progress-width, 0%);
            transition: width 0.3s ease;
        }
        /* Sidebar nav active state (Màu xanh tre đậm) */
        #sectionList button.active {
            background-color: #059669; /* bg-emerald-600 */
            color: white;
            font-weight: 600;
        }
        /* Style cho nút upload file (Màu xanh tre nhạt) */
        input[type="file"]::file-selector-button {
            margin-right: 1rem;
            padding: 0.5rem 1rem;
            border-radius: 9999px; /* rounded-full */
            border: 0;
            font-size: 0.875rem; /* text-sm */
            font-weight: 600; /* font-semibold */
            background-color: #ecfdf5; /* bg-emerald-50 */
            color: #047857; /* text-emerald-700 */
            cursor: pointer;
            transition: background-color 0.2s;
        }
        input[type="file"]::file-selector-button:hover {
            background-color: #d1fae5; /* bg-emerald-100 */
        }
    </style>
</head>
<body class="bg-gray-50">

    <div id="screen-setup" class="screen active max-w-2xl mx-auto p-8 bg-white shadow-lg rounded-xl mt-16 border border-emerald-100">
        <h1 class="text-3xl font-bold text-emerald-700 mb-4">Audit Tool ISO 27001:2022</h1>
        <p class="text-gray-600 mb-8 leading-relaxed">Chào mừng quý khách.</p>
		<p class="text-gray-600 mb-8 leading-relaxed">Bắt đầu một phiên đánh giá bằng cách nhập tên Công ty / Tổ chức.</p>
        <div>
            <label for="clientName" class="block text-sm font-medium text-gray-700 mb-2">Tên Công ty / Tổ chức</label>
            <input type="text" id="clientName" class="block w-full p-4 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 text-lg placeholder-gray-400" placeholder="Ví dụ: Ngân hàng ABC, Công ty XYZ...">
        </div>
        <button id="startButton" class="mt-8 w-full bg-emerald-600 text-white py-4 px-6 rounded-lg text-xl font-semibold hover:bg-emerald-700 transition duration-200 shadow-md active:scale-[0.98]">
            Bắt đầu Audit
        </button>
    </div>

    <div id="screen-audit" class="screen max-w-[90rem] mx-auto p-4 md:p-6 mt-4">
        <div class="flex flex-col lg:flex-row gap-6">
            
            <nav class="w-full lg:w-1/4 xl:w-1/5">
                <div class="bg-white p-5 shadow-md rounded-xl sticky top-6 border border-gray-100">
                    <h2 class="text-lg font-bold text-gray-800 mb-4 border-b pb-3">Nội dung Đánh giá</h2>
                    <ul id="sectionList" class="space-y-1 max-h-[80vh] overflow-y-auto pr-2">
                        </ul>
                </div>
            </nav>

            <div class="flex-1">
                <div class="bg-white p-5 shadow-md rounded-xl mb-6 border border-gray-100">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4 gap-4">
                        <h1 class="text-2xl font-bold text-gray-800 flex-1">
                            <span class="text-sm font-normal text-gray-500 block mb-1">Công ty / Tổ chức:</span>
                            <span id="clientNameDisplay" class="text-emerald-700"></span>
                        </h1>
                        <button id="saveReportButton" class="flex-shrink-0 bg-emerald-800 text-white py-2.5 px-6 rounded-lg font-semibold hover:bg-emerald-900 transition shadow flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4" />
                            </svg>
                            Lưu Báo cáo & Thoát
                        </button>
                    </div>
                    <div class="bg-gray-50 p-3 rounded-lg">
                        <div class="flex justify-between text-sm font-medium text-gray-700 mb-2">
                            <span>Tiến độ hoàn thành</span>
                            <span id="progressText" class="text-emerald-700 font-bold">0/121</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-3">
                            <div id="progressBar" class="progress-bar bg-emerald-500 h-3 rounded-full relative">
                                <span class="absolute right-0 top-1/2 -translate-y-1/2 w-3 h-3 bg-white border-2 border-emerald-600 rounded-full shadow"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-6 md:p-8 shadow-md rounded-xl border border-gray-100">
                    <div class="border-b border-gray-100 pb-6 mb-6">
                        <div class="flex justify-between items-center mb-3">
                            <span class="text-xs md:text-sm font-bold text-emerald-700 bg-emerald-50 border border-emerald-100 py-1.5 px-4 rounded-full" id="controlSection"></span>
                            <span class="text-sm font-mono text-gray-500 bg-gray-100 px-2 py-1 rounded" id="controlId"></span>
                        </div>
                        <h2 class="text-xl md:text-3xl font-bold text-gray-800 leading-tight" id="controlQuestion"></h2>

                         <div id="explanationArea" class="mt-4 hidden">
                            <button id="toggleExplanation" type="button" class="group flex items-center text-sm font-medium text-emerald-600 hover:text-emerald-800 focus:outline-none transition-colors duration-200 bg-emerald-50 hover:bg-emerald-100 px-3 py-2 rounded-lg">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 transition-transform group-hover:scale-110" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                                Xem Hướng dẫn / Gợi ý kiểm tra
                            </button>
                            <div id="explanationContent" class="mt-3 p-5 bg-emerald-50/50 border border-emerald-100 rounded-xl text-gray-800 text-sm leading-relaxed hidden">
                                </div>
                        </div>
                    </div>
                    
                    <div class="space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8">
                            <div>
                                <label for="controlStatus" class="block text-sm font-semibold text-gray-700 mb-2">Trạng thái (Status)</label>
                                <div class="relative">
                                    <select id="controlStatus" class="block w-full p-3 pl-4 pr-10 border border-gray-300 rounded-lg shadow-sm appearance-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 text-base bg-white">
                                        <option value="Bỏ qua" class="text-gray-400">(Chưa chọn / Bỏ qua)</option>
                                        <option value="Tuân thủ" class="font-medium text-green-700">✓ Tuân thủ (Compliant)</option>
                                        <option value="Không Tuân thủ (NC)" class="font-medium text-red-700">✕ Không Tuân thủ (Non-Compliant)</option>
                                        <option value="Không Áp dụng" class="text-gray-600">○ Không Áp dụng (N/A)</option>
                                    </select>
                                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-500">
                                        <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <label for="controlEvidenceUpload" class="block text-sm font-semibold text-gray-700 mb-2">Đính kèm Bằng chứng (File)</label>
                                <div class="flex items-center justify-center w-full">
                                    <label for="controlEvidenceUpload" class="flex flex-col items-center justify-center w-full h-32 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-emerald-50 hover:border-emerald-400 transition">
                                        <div class="flex flex-col items-center justify-center pt-5 pb-6">
                                            <svg class="w-8 h-8 mb-3 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg>
                                            <p class="mb-2 text-sm text-gray-500"><span class="font-semibold">Click để tải lên</span> hoặc kéo thả file vào đây</p>
                                            <p class="text-xs text-gray-500">(Ảnh, PDF, Excel, Word...)</p>
                                        </div>
                                        <input id="controlEvidenceUpload" type="file" class="hidden" />
                                    </label>
                                </div> 
                                <div id="evidenceStatus" class="mt-3 text-sm font-medium flex items-center min-h-[24px]">
                                    <span class="text-gray-400">Chưa có file bằng chứng.</span>
                                </div>
                            </div>
                        </div>
                        <div>
                            <label for="controlNote" class="block text-sm font-semibold text-gray-700 mb-2">Ghi chú / Phát hiện (Note / Finding)</label>
                            <textarea id="controlNote" rows="5" class="block w-full p-4 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 text-base resize-y" placeholder="• Ghi rõ tên bằng chứng nếu 'Tuân thủ'&#10;• Mô tả chi tiết lỗi nếu 'Không tuân thủ'"></textarea>
                        </div>
                    </div>

                    <div class="flex justify-between items-center mt-10 pt-6 border-t border-gray-100">
                        <button id="prevButton" class="flex items-center px-5 py-2.5 bg-gray-100 text-gray-700 rounded-lg font-medium hover:bg-gray-200 transition disabled:opacity-50 disabled:cursor-not-allowed">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                              <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" />
                            </svg>
                            Quay lại
                        </button>
                        <span class="text-lg font-bold text-gray-500" id="controlCounter">1 / 121</span>
                        <button id="nextButton" class="flex items-center px-6 py-2.5 bg-emerald-600 text-white rounded-lg font-medium hover:bg-emerald-700 transition shadow-md">
                            Tiếp theo
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2" viewBox="0 0 20 20" fill="currentColor">
                              <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="screen-done" class="screen max-w-2xl mx-auto p-10 bg-white shadow-xl rounded-2xl mt-20 text-center border border-emerald-50">
        <div class="w-20 h-20 bg-emerald-100 rounded-full flex items-center justify-center mx-auto mb-6">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-emerald-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
        </div>
        <h1 class="text-4xl font-bold text-emerald-700 mb-4">Audit Hoàn tất!</h1>
        <p class="text-gray-600 mb-8 text-lg">Chúc mừng bạn đã hoàn thành phiên đánh giá. Báo cáo đã được lưu về máy.</p>
        <div class="bg-gray-50 p-4 rounded-lg mb-8 border border-gray-200 inline-block">
             <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-400 inline-block mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
            </svg>
            <code id="reportFileName" class="font-mono text-emerald-700 font-medium"></code>
        </div>
        <button id="restartButton" class="block w-full bg-emerald-600 text-white py-4 px-6 rounded-xl text-lg font-semibold hover:bg-emerald-700 transition duration-200 shadow-md">
            Bắt đầu phiên Audit mới
        </button>
    </div>


<script>
// --- FULL DATABASE ISO 27001:2022 (Đã bao gồm Explanation) ---
const CHECKLIST_DATA = [
  // === PHẦN 1: CÁC ĐIỀU KHOẢN QUẢN LÝ (CLAUSES 4-10) ===
  {
    "section": "Điều khoản 4-10",
    "id": "4.1",
    "question": "(4.1) Đã có tài liệu xác định các vấn đề nội bộ/bên ngoài liên quan đến ATTT chưa?",
    "explanation": "<b>Ý nghĩa:</b> Xác định 'hoàn cảnh' của tổ chức (Bên ngoài: luật pháp, thị trường...; Bên trong: văn hóa, hạ tầng...) để làm đầu vào đánh giá rủi ro.<br><b>Bằng chứng:</b> Tài liệu 'Bối cảnh tổ chức', Phân tích SWOT ATTT."
  },
  {
    "section": "Điều khoản 4-10",
    "id": "4.2",
    "question": "(4.2) Đã có danh sách các bên quan tâm và các yêu cầu ATTT của họ chưa?",
    "explanation": "<b>Ý nghĩa:</b> Xác định rõ ai (Khách hàng, Cơ quan quản lý, Cổ đông...) đang mong đợi gì ở hệ thống bảo mật để đáp ứng.<br><b>Bằng chứng:</b> Danh sách các bên liên quan và yêu cầu cụ thể."
  },
  {
    "section": "Điều khoản 4-10",
    "id": "4.3",
    "question": "(4.3) Đã có tài liệu định nghĩa Phạm vi ISMS (Scope document) rõ ràng và hợp lý chưa?",
    "explanation": "<b>Ý nghĩa:</b> Khoanh vùng ranh giới áp dụng ISMS (ghi rõ áp dụng tại văn phòng nào, cho hệ thống IT nào, phòng ban nào).<br><b>Bằng chứng:</b> Tài liệu Phạm vi ISMS (Scope Statement)."
  },
  {
    "section": "Điều khoản 4-10",
    "id": "4.4",
    "question": "(4.4) ISMS và các quy trình (Chính sách, Quy trình) đã được thiết lập chưa?",
    "explanation": "<b>Ý nghĩa:</b> Yêu cầu tổng quát, tổ chức phải xây dựng, vận hành hệ thống.<br><b>Bằng chứng:</b> Hệ thống tài liệu quy trình đã được ban hành và đang vận hành."
  },
  {
    "section": "Điều khoản 4-10",
    "id": "5.1",
    "question": "(5.1) Lãnh đạo cấp cao có thể hiện sự cam kết không? (Bằng chứng: cấp nguồn lực, ngân sách)",
    "explanation": "<b>Ý nghĩa:</b> Lãnh đạo phải 'chi tiền' và 'dẫn dắt', không chỉ nói suông.<br><b>Bằng chứng:</b> Biên bản họp có Lãnh đạo tham gia, Quyết định phê duyệt ngân sách ATTT."
  },
  {
    "section": "Điều khoản 4-10",
    "id": "5.2",
    "question": "(5.2) Chính sách ATTT (1.1) đã được Lãnh đạo cấp cao phê duyệt và truyền thông chưa?",
    "explanation": "<b>Ý nghĩa:</b> 'Hiến pháp' về bảo mật của công ty.<br><b>Bằng chứng:</b> Chính sách ATTT có chữ ký Giám đốc, email thông báo cho toàn nhân viên."
  },
  {
    "section": "Điều khoản 4-10",
    "id": "5.3",
    "question": "(5.3) Đã có tài liệu phân công vai trò, trách nhiệm ATTT chưa? (Ví dụ: Ma trận RACI 7.2)",
    "explanation": "<b>Ý nghĩa:</b> 'Rõ người, rõ việc'. Ai chịu trách nhiệm chính (Accountable) khi có sự cố?<br><b>Bằng chứng:</b> Sơ đồ tổ chức ATTT, Ma trận phân nhiệm (RACI), Mô tả công việc (JD)."
  },
  {
    "section": "Điều khoản 4-10",
    "id": "6.1.1",
    "question": "(6.1.1) Đã có các hành động để giải quyết rủi ro và cơ hội (từ 4.1) chưa?",
    "explanation": "<b>Ý nghĩa:</b> Đảm bảo hệ thống đạt mục tiêu, giảm tác động xấu.<br><b>Bằng chứng:</b> Kế hoạch giải quyết rủi ro/cơ hội (tích hợp trong RTP)."
  },
  {
    "section": "Điều khoản 4-10",
    "id": "6.1.2",
    "question": "(6.1.2) Đã có Quy trình Quản lý Rủi ro (2.1) và Ma trận Rủi ro (3.4) nhất quán chưa?",
    "explanation": "<b>Ý nghĩa:</b> Cần một 'công thức' thống nhất để tính điểm rủi ro.<br><b>Bằng chứng:</b> Quy trình Đánh giá rủi ro, Bảng tiêu chí chấm điểm (Impact x Likelihood)."
  },
  {
    "section": "Điều khoản 4-10",
    "id": "6.1.2b",
    "question": "(6.1.2) Đã có kết quả đánh giá rủi ro (bảng rủi ro) và tiêu chí chấp nhận rủi ro được phê duyệt chưa?",
    "explanation": "<b>Ý nghĩa:</b> Kết quả chạy quy trình trên. Rủi ro mức nào (VD: Trung bình) thì phải xử lý?<br><b>Bằng chứng:</b> Báo cáo/Bảng Excel đánh giá rủi ro chi tiết."
  },
  {
    "section": "Điều khoản 4-10",
    "id": "6.1.3",
    "question": "(6.1.3) Đã có Kế hoạch Xử lý Rủi ro (RTP - 3.5) chưa?",
    "explanation": "<b>Ý nghĩa:</b> Ai làm gì, bao giờ xong để giảm rủi ro xuống mức chấp nhận được?<br><b>Bằng chứng:</b> Kế hoạch xử lý rủi ro (Risk Treatment Plan - RTP)."
  },
  {
    "section": "Điều khoản 4-10",
    "id": "6.1.3b",
    "question": "(6.1.3) Đã có Tuyên bố Áp dụng (SoA) được phê duyệt, liên kết logic với RTP và liệt kê đủ 93 controls chưa?",
    "explanation": "<b>Ý nghĩa:</b> Tài liệu bắt buộc quan trọng nhất. Liệt kê 93 controls, cái nào dùng/không dùng, lý do.<br><b>Bằng chứng:</b> Tài liệu SoA (Statement of Applicability)."
  },
  {
    "section": "Điều khoản 4-10",
    "id": "6.2",
    "question": "(6.2) Đã có các mục tiêu ATTT đo lường được (KPIs) ngoài các mục tiêu trong chính sách 1.1 chưa?",
    "explanation": "<b>Ý nghĩa:</b> Mục tiêu SMART (VD: Giảm 20% sự cố, 100% nhân viên được đào tạo).<br><b>Bằng chứng:</b> Bảng theo dõi KPI/Mục tiêu ATTT năm."
  },
  {
    "section": "Điều khoản 4-10",
    "id": "7.1",
    "question": "(7.1) Đã có bằng chứng về việc cung cấp nguồn lực (ngân sách, nhân sự) cho ISMS chưa?",
    "explanation": "<b>Ý nghĩa:</b> Có thực mới vực được đạo. Cần người và tiền để vận hành.<br><b>Bằng chứng:</b> Ngân sách ATTT được duyệt, quyết định bổ nhiệm nhân sự."
  },
  {
    "section": "Điều khoản 4-10",
    "id": "7.2",
    "question": "(7.2) Đã có hồ sơ năng lực (chứng chỉ) của các nhân sự ATTT chủ chốt chưa?",
    "explanation": "<b>Ý nghĩa:</b> Người làm bảo mật phải có trình độ phù hợp.<br><b>Bằng chứng:</b> CV, bằng cấp, chứng chỉ (CISSP, CISM, Security+...) của đội IT/Security."
  },
  {
    "section": "Điều khoản 4-10",
    "id": "7.3",
    "question": "(7.3) Đã có bằng chứng về đào tạo nhận thức ATTT (A.6.3) chưa? (slide, danh sách tham dự, kết quả test)",
    "explanation": "<b>Ý nghĩa:</b> Đào tạo để nhân viên không là 'điểm yếu' của hệ thống.<br><b>Bằng chứng:</b> Slide đào tạo, danh sách điểm danh, bài test sau khóa học."
  },
  {
    "section": "Điều khoản 4-10",
    "id": "7.4",
    "question": "(7.4) Đã có quy trình truyền thông nội bộ và bên ngoài về ISMS chưa?",
    "explanation": "<b>Ý nghĩa:</b> Khi có sự cố thì báo ai? Ai được phát ngôn với báo chí?<br><b>Bằng chứng:</b> Kế hoạch truyền thông, quy trình phản ứng sự cố (phần liên lạc)."
  },
  {
    "section": "Điều khoản 4-10",
    "id": "7.5",
    "question": "(7.5) Đã có Quy trình Kiểm soát Thông tin dạng văn bản (Document Control) chưa? (Có mã, phiên bản, phê duyệt, thu hồi tài liệu cũ?)",
    "explanation": "<b>Ý nghĩa:</b> Đảm bảo mọi người dùng đúng phiên bản quy trình mới nhất.<br><b>Bằng chứng:</b> Quy trình kiểm soát tài liệu, Master List danh mục tài liệu."
  },
  {
    "section": "Điều khoản 4-10",
    "id": "8.1",
    "question": "(8.1) Đã có bằng chứng về việc lập kế hoạch và kiểm soát vận hành chưa? (Ví dụ: Quy trình 2.6 - Quản lý Thay đổi)",
    "explanation": "<b>Ý nghĩa:</b> Kiểm soát các thay đổi để không làm sập hệ thống.<br><b>Bằng chứng:</b> Quy trình quản lý thay đổi, các phiếu yêu cầu thay đổi (RFC) đã duyệt."
  },
  {
    "section": "Điều khoản 4-10",
    "id": "8.2",
    "question": "(8.2) Đã có Báo cáo Đánh giá Rủi ro (kết quả của Quy trình 2.1) chưa?",
    "explanation": "<b>Ý nghĩa:</b> Thực hiện đánh giá lại rủi ro định kỳ hoặc khi có thay đổi lớn.<br><b>Bằng chứng:</b> Các báo cáo đánh giá rủi ro gần nhất."
  },
  {
    "section": "Điều khoản 4-10",
    "id": "8.3",
    "question": "(8.3) Đã có bằng chứng về việc thực hiện các Kế hoạch Xử lý Rủi ro (RTP - 3.5) chưa?",
    "explanation": "<b>Ý nghĩa:</b> Đã lập kế hoạch thì phải làm (VD: đã mua firewall thì phải lắp đặt).<br><b>Bằng chứng:</b> Báo cáo tiến độ RTP, biên bản nghiệm thu các dự án bảo mật."
  },
  {
    "section": "Điều khoản 4-10",
    "id": "9.1",
    "question": "(9.1) Tổ chức có đo lường, giám sát, phân tích và đánh giá ISMS không? (Có báo cáo KPI/metric không?)",
    "explanation": "<b>Ý nghĩa:</b> Không đo lường thì không quản lý được. Hệ thống đang tốt lên hay xấu đi?<br><b>Bằng chứng:</b> Báo cáo giám sát định kỳ, dashboard KPI ATTT."
  },
  {
    "section": "Điều khoản 4-10",
    "id": "9.2",
    "question": "(9.2) Đã có Chương trình và Báo cáo Đánh giá Nội bộ (3.1) gần nhất chưa? Đánh giá có khách quan không?",
    "explanation": "<b>Ý nghĩa:</b> Tự 'khám bệnh' trước khi Auditor bên ngoài đến. Phải khách quan (không tự đánh giá mình).<br><b>Bằng chứng:</b> Kế hoạch & Báo cáo đánh giá nội bộ, các phiếu ghi nhận lỗi (NC)."
  },
  {
    "section": "Điều khoản 4-10",
    "id": "9.3",
    "question": "(9.3) Đã có bằng chứng về cuộc họp Xem xét của Lãnh đạo (Management Review) gần nhất chưa? (slide, biên bản họp, danh sách tham dự)",
    "explanation": "<b>Ý nghĩa:</b> Cuộc họp quan trọng nhất để Lãnh đạo nắm tình hình và chỉ đạo.<br><b>Bằng chứng:</b> Biên bản họp Xem xét lãnh đạo (bắt buộc có)."
  },
  {
    "section": "Điều khoản 4-10",
    "id": "9.3b",
    "question": "(9.3) Cuộc họp Xem xét của Lãnh đạo có đủ các đầu vào (inputs) theo yêu cầu 9.3.2 không? (kết quả rủi ro, audit, sự cố...)",
    "explanation": "<b>Ý nghĩa:</b> Đảm bảo báo cáo đủ các vấn đề nóng cho lãnh đạo quyết định.<br><b>Bằng chứng:</b> Slide báo cáo trong cuộc họp (phải đủ các mục theo chuẩn)."
  },
  {
    "section": "Điều khoản 4-10",
    "id": "10.1",
    "question": "(10.1) Đã có bằng chứng về các cơ hội cải tiến (từ 9.3) chưa?",
    "explanation": "<b>Ý nghĩa:</b> Luôn tìm cách làm hệ thống tốt hơn (Continual Improvement).<br><b>Bằng chứng:</b> Danh sách các sáng kiến/dự án cải tiến ATTT."
  },
  {
    "section": "Điều khoản 4-10",
    "id": "10.2",
    "question": "(10.2) Các Điểm không phù hợp (NCs) (từ 9.2) đã được phân tích nguyên nhân gốc rễ và thực hiện hành động khắc phục chưa?",
    "explanation": "<b>Ý nghĩa:</b> Sai phải sửa tận gốc để không lặp lại.<br><b>Bằng chứng:</b> Các phiếu hành động khắc phục (CAR), báo cáo phân tích nguyên nhân (Root Cause Analysis)."
  },

  // === PHẦN 2: ANNEX A.5 - TỔ CHỨC (ORGANIZATIONAL) ===
  {
    "section": "A.5 Tổ chức",
    "id": "A.5.1",
    "question": "(A.5.1) Chính sách ATTT (1.1) và các chính sách chuyên đề (1.2-1.10) đã được phê duyệt, ban hành, truyền thông chưa?",
    "explanation": "<b>Ý nghĩa:</b> Các 'bộ luật' con (VD: Chính sách mật khẩu, AUP, Truy cập).<br><b>Bằng chứng:</b> Hệ thống văn bản chính sách đã ban hành trên Portal."
  },
  {
    "section": "A.5 Tổ chức",
    "id": "A.5.2",
    "question": "(A.5.2) Đã có Ma trận RACI (7.2), Mô tả công việc? Nhân sự có hiểu trách nhiệm ATTT của mình không?",
    "explanation": "<b>Ý nghĩa:</b> Phân vai rõ ràng trong từng quy trình cụ thể.<br><b>Bằng chứng:</b> Ma trận RACI cho các quy trình chính (Sự cố, Thay đổi)."
  },
  {
    "section": "A.5 Tổ chức",
    "id": "A.5.3",
    "question": "(A.5.3) Các quy trình nhạy cảm (Quản lý thay đổi, Cấp quyền) có đảm bảo phân tách nhiệm vụ (người yêu cầu, phê duyệt, thực hiện khác nhau) không?",
    "explanation": "<b>Ý nghĩa:</b> Tránh 'vừa đá bóng vừa thổi còi'. Dev không nên tự deploy lên Production.<br><b>Bằng chứng:</b> Quy trình cấp quyền, log hệ thống thể hiện sự phân tách."
  },
  {
    "section": "A.5 Tổ chức",
    "id": "A.5.4",
    "question": "(A.5.4) Cấp quản lý (Trưởng phòng) có thúc đẩy nhân viên tuân thủ chính sách ATTT không?",
    "explanation": "<b>Ý nghĩa:</b> Sếp phải làm gương thì lính mới nghe.<br><b>Bằng chứng:</b> Phỏng vấn nhân viên, email nhắc nhở của quản lý."
  },
  {
    "section": "A.5 Tổ chức",
    "id": "A.5.5",
    "question": "(A.5.5) Tổ chức có xác định và duy trì liên lạc với các cơ quan có thẩm quyền (VNCERT/CC, A05...) không?",
    "explanation": "<b>Ý nghĩa:</b> Biết gọi ai khi bị tấn công lớn hoặc cần hỗ trợ pháp lý.<br><b>Bằng chứng:</b> Danh bạ liên lạc khẩn cấp (công an, cơ quan điều phối)."
  },
  {
    "section": "A.5 Tổ chức",
    "id": "A.5.6",
    "question": "(A.5.6) Tổ chức có tham gia các diễn đàn, hiệp hội ATTT chuyên ngành (ISACA, (ISC)²) không?",
    "explanation": "<b>Ý nghĩa:</b> Cập nhật kiến thức mới, tránh 'ếch ngồi đáy giếng'.<br><b>Bằng chứng:</b> Thẻ hội viên, chứng nhận tham gia hội thảo."
  },
  {
    "section": "A.5 Tổ chức",
    "id": "A.5.7",
    "question": "(A.5.7) Tổ chức có thu thập và phân tích thông tin về mối đe dọa (Threat Intelligence) từ SOC/MSSP không? Có hành động gì được thực hiện không?",
    "explanation": "<b>Ý nghĩa:</b> 'Biết địch biết ta'. Theo dõi các nhóm hacker đang nhắm vào ngành mình.<br><b>Bằng chứng:</b> Báo cáo Threat Intel, các rule firewall cập nhật theo Intel."
  },
  {
    "section": "A.5 Tổ chức",
    "id": "A.5.8",
    "question": "(A.5.8) Các dự án đang chạy có được đánh giá rủi ro ATTT trong quá trình thực hiện không?",
    "explanation": "<b>Ý nghĩa:</b> Bảo mật phải đi cùng dự án từ đầu (Security by Design).<br><b>Bằng chứng:</b> Báo cáo đánh giá rủi ro dự án, biên bản họp khởi động."
  },
  {
    "section": "A.5 Tổ chức",
    "id": "A.5.9",
    "question": "(A.5.9) Danh sách Tài sản (3.2) có đầy đủ không (HW, SW, Data, Services...)?",
    "explanation": "<b>Ý nghĩa:</b> Không biết mình có gì thì không thể bảo vệ. Cần kiểm kê đủ.<br><b>Bằng chứng:</b> File Inventory/CMDB tài sản CNTT."
  },
  {
    "section": "A.5 Tổ chức",
    "id": "A.5.10",
    "question": "(A.5.10) Chính sách Sử dụng Chấp nhận được (AUP) đã được truyền thông (qua Sổ tay nhân viên) chưa?",
    "explanation": "<b>Ý nghĩa:</b> Quy định rõ được làm gì/cấm làm gì trên máy công ty (VD: cấm game, web đen).<br><b>Bằng chứng:</b> Sổ tay nhân viên, cam kết AUP đã ký."
  },
  {
    "section": "A.5 Tổ chức",
    "id": "A.5.11",
    "question": "(A.5.11) Quy trình nghỉ việc (Off-boarding) của HR có đảm bảo nhân viên trả lại mọi tài sản (laptop, thẻ) không?",
    "explanation": "<b>Ý nghĩa:</b> Thu hồi tài sản và quan trọng nhất là cắt quyền truy cập ngay khi nghỉ.<br><b>Bằng chứng:</b> Checklist bàn giao nghỉ việc (có xác nhận IT)."
  },
  {
    "section": "A.5 Tổ chức",
    "id": "A.5.12",
    "question": "(A.5.12) Thông tin đã được phân loại (Mật, Nội bộ...) trong Chính sách (1.7) và Danh sách Tài sản (3.2) chưa?",
    "explanation": "<b>Ý nghĩa:</b> Phân loại để biết cái nào quan trọng cần ưu tiên bảo vệ kỹ.<br><b>Bằng chứng:</b> Quy định phân loại thông tin, danh sách tài sản có cột 'Mức độ mật'."
  },
  {
    "section": "A.5 Tổ chức",
    "id": "A.5.13",
    "question": "(A.5.13) Thông tin nhạy cảm (tài liệu, email, ổ đĩa) có được dán nhãn \"Mật\" (hoặc tương đương) không?",
    "explanation": "<b>Ý nghĩa:</b> Dán nhãn trực quan để người dùng biết cách xử lý phù hợp.<br><b>Bằng chứng:</b> Quan sát thực tế tài liệu, email có nhãn 'MẬT'/'INTERNAL'."
  },
  {
    "section": "A.5 Tổ chức",
    "id": "A.5.14",
    "question": "(A.5.14) Tổ chức có quy định về việc chuyển giao thông tin nhạy cảm ra ngoài (email, USB, Cloud) không?",
    "explanation": "<b>Ý nghĩa:</b> Kiểm soát đường đi của dữ liệu mật (VD: bắt buộc mã hóa khi gửi email ra ngoài).<br><b>Bằng chứng:</b> Quy định trao đổi thông tin, giải pháp DLP."
  },
  {
    "section": "A.5 Tổ chức",
    "id": "A.5.15",
    "question": "(A.5.15) Chính sách KSTC (1.2) và Quy trình (2.5) có dựa trên nguyên tắc \"Cần biết\" và \"Đặc quyền tối thiểu\" không?",
    "explanation": "<b>Ý nghĩa:</b> Chỉ cấp quyền vừa đủ để làm việc, không cấp dư.<br><b>Bằng chứng:</b> Ma trận phân quyền (Access Matrix) cho các hệ thống."
  },
  {
    "section": "A.5 Tổ chức",
    "id": "A.5.16",
    "question": "(A.5.16) Quy trình tạo/xóa tài khoản có đảm bảo mọi tài khoản được liên kết duy nhất với một cá nhân/hệ thống không?",
    "explanation": "<b>Ý nghĩa:</b> Tránh dùng chung tài khoản để đảm bảo quy trách nhiệm.<br><b>Bằng chứng:</b> Danh sách user trên AD (không có user chung kiểu 'ketoan1')."
  },
  {
    "section": "A.5 Tổ chức",
    "id": "A.5.17",
    "question": "(A.5.17) Chính sách Mật khẩu (1.4) có được tuân thủ không (đủ phức tạp, đổi định kỳ, cấm mật khẩu mặc định, có MFA)?",
    "explanation": "<b>Ý nghĩa:</b> Mật khẩu yếu dễ bị hack. Cần độ phức tạp cao và khuyến nghị MFA.<br><b>Bằng chứng:</b> Cấu hình Password Policy trên hệ thống."
  },
  {
    "section": "A.5 Tổ chức",
    "id": "A.5.18",
    "question": "(A.5.18) Đã có hồ sơ (email, Biểu mẫu 3.6) rà soát quyền truy cập 6 tháng gần nhất? Chủ sở hữu tài sản có rà soát và phê duyệt không?",
    "explanation": "<b>Ý nghĩa:</b> Định kỳ kiểm tra để cắt quyền những người đã chuyển bộ phận.<br><b>Bằng chứng:</b> Biên bản rà soát quyền (Access Review) định kỳ."
  },
  {
    "section": "A.5 Tổ chức",
    "id": "A.5.19",
    "question": "(A.5.19) Tổ chức có đánh giá rủi ro ATTT của NCC (Cloud, ICT) trước khi ký hợp đồng không? (Xem Chính sách 1.10)",
    "explanation": "<b>Ý nghĩa:</b> 'Chọn bạn mà chơi'. Đảm bảo đối tác cũng an toàn.<br><b>Bằng chứng:</b> Phiếu đánh giá an ninh nhà cung cấp trước khi ký HĐ."
  },
  {
    "section": "A.5 Tổ chức",
    "id": "A.5.20",
    "question": "(A.5.20) Hợp đồng NCC (sample) có bao gồm các điều khoản ATTT ràng buộc (tuân thủ, báo cáo sự cố, quyền audit) không?",
    "explanation": "<b>Ý nghĩa:</b> Ràng buộc pháp lý trách nhiệm nếu họ làm lộ dữ liệu của mình.<br><b>Bằng chứng:</b> Hợp đồng mẫu, thỏa thuận bảo mật (NDA/DPA) với đối tác."
  },
  {
    "section": "A.5 Tổ chức",
    "id": "A.5.21",
    "question": "(A.5.21) Tổ chức quản lý rủi ro từ chuỗi cung ứng ICT (nhà cung cấp phần cứng, phần mềm) như thế nào?",
    "explanation": "<b>Ý nghĩa:</b> Tránh mua phải thiết bị/phần mềm có cài sẵn mã độc (Supply Chain Attack).<br><b>Bằng chứng:</b> Quy trình mua sắm ICT, yêu cầu CO/CQ, scan thiết bị trước khi dùng."
  },
  {
    "section": "A.5 Tổ chức",
    "id": "A.5.22",
    "question": "(A.5.22) Tổ chức có rà soát hiệu suất ATTT của các NCC quan trọng hàng năm không (yêu cầu chứng chỉ, báo cáo)?",
    "explanation": "<b>Ý nghĩa:</b> Giám sát định kỳ xem đối tác còn giữ vững phong độ bảo mật không.<br><b>Bằng chứng:</b> Báo cáo đánh giá định kỳ nhà cung cấp."
  },
  {
    "section": "A.5 Tổ chức",
    "id": "A.5.23",
    "question": "(A.5.23) Khi NCC (ví dụ: nhà cung cấp Cloud) thay đổi dịch vụ, tổ chức có quy trình đánh giá rủi ro không?",
    "explanation": "<b>Ý nghĩa:</b> Khi AWS/Azure thay đổi tính năng, có ảnh hưởng gì đến mình không?<br><b>Bằng chứng:</b> Đánh giá tác động khi đối tác có thay đổi lớn."
  },
  {
    "section": "A.5 Tổ chức",
    "id": "A.5.24",
    "question": "(A.5.24) Kế hoạch Quản lý Sự cố (1.5, 2.2) đã rõ ràng vai trò, trách nhiệm (Đội IRT) chưa?",
    "explanation": "<b>Ý nghĩa:</b> Khi 'cháy nhà' thì ai làm gì? Cần rõ ràng từ trước.<br><b>Bằng chứng:</b> Quyết định thành lập Đội ứng cứu sự cố (IRT)."
  },
  {
    "section": "A.5 Tổ chức",
    "id": "A.5.25",
    "question": "(A.5.25) Các sự kiện ATTT (events) có được đánh giá để xác định xem chúng có phải là sự cố (incidents) không? Ai chịu trách nhiệm?",
    "explanation": "<b>Ý nghĩa:</b> Phân loại để biết cái nào là cảnh báo giả, cái nào là sự cố thật cần xử lý.<br><b>Bằng chứng:</b> Quy trình phân loại mức độ sự cố (P1, P2, P3)."
  },
  {
    "section": "A.5 Tổ chức",
    "id": "A.5.26",
    "question": "(A.5.26) Đã xem Nhật ký Sự cố (3.3)? Các bước xử lý (Ngăn chặn, Tiêu diệt, Phục hồi) có được ghi lại không?",
    "explanation": "<b>Ý nghĩa:</b> Ghi chép lại quá trình xử lý để rút kinh nghiệm và làm bằng chứng.<br><b>Bằng chứng:</b> Sổ nhật ký sự cố (Incident Logbook/Ticket)."
  },
  {
    "section": "A.5 Tổ chức",
    "id": "A.5.27",
    "question": "(A.5.27) Các sự cố nghiêm trọng (trong 3.3) có được phân tích nguyên nhân gốc rễ (root cause) và rút bài học kinh nghiệm không?",
    "explanation": "<b>Ý nghĩa:</b> Tìm nguyên nhân gốc để không bị lại lỗi tương tự.<br><b>Bằng chứng:</b> Báo cáo phân tích sau sự cố (Post-Incident Review)."
  },
  {
    "section": "A.5 Tổ chức",
    "id": "A.5.28",
    "question": "(A.5.28) Tổ chức có quy trình thu thập và bảo quản bằng chứng kỹ thuật số (digital forensics) khi xảy ra sự cố không?",
    "explanation": "<b>Ý nghĩa:</b> Bảo vệ hiện trường số (dump RAM, copy ổ cứng) đúng cách để phục vụ điều tra.<br><b>Bằng chứng:</b> Quy trình điều tra số (Forensics)."
  },
  {
    "section": "A.5 Tổ chức",
    "id": "A.5.29",
    "question": "(A.5.29) Kế hoạch Kinh doanh Liên tục (BCP) có tích hợp các yêu cầu ATTT (bảo mật, toàn vẹn) khi hoạt động ở trạng thái dự phòng không?",
    "explanation": "<b>Ý nghĩa:</b> Chạy site dự phòng (DR) vẫn phải đảm bảo an toàn (vẫn cần firewall, antivirus...).<br><b>Bằng chứng:</b> Kế hoạch BCP/DRP có mục yêu cầu bảo mật."
  },
  {
    "section": "A.5 Tổ chức",
    "id": "A.5.30",
    "question": "(A.5.30) Đã thực hiện BIA, xác định RTO/RPO chưa? Đã có báo cáo diễn tập DRP/BCP (theo Chính sách 1.6) chưa?",
    "explanation": "<b>Ý nghĩa:</b> Biết hệ thống nào quan trọng nhất, bao lâu phải khôi phục xong. Phải diễn tập thử.<br><b>Bằng chứng:</b> Báo cáo BIA, Báo cáo kết quả diễn tập DRP."
  },
  {
    "section": "A.5 Tổ chức",
    "id": "A.5.31",
    "question": "(A.5.31) Tổ chức có danh sách các yêu cầu pháp lý (Luật An ninh mạng, Nghị định 13) và yêu cầu hợp đồng liên quan đến ATTT không?",
    "explanation": "<b>Ý nghĩa:</b> Tránh bị phạt vì không biết luật. Liệt kê hết các luật phải tuân thủ.<br><b>Bằng chứng:</b> Danh mục văn bản pháp quy ATTT."
  },
  {
    "section": "A.5 Tổ chức",
    "id": "A.5.32",
    "question": "(A.5.32) Tổ chức có biện pháp bảo vệ IP (mã nguồn, tài liệu thiết kế) và tuân thủ bản quyền phần mềm không?",
    "explanation": "<b>Ý nghĩa:</b> Không dùng phần mềm lậu. Bảo vệ tài sản trí tuệ của mình.<br><b>Bằng chứng:</b> Chính sách bản quyền, danh sách license đã mua."
  },
  {
    "section": "A.5 Tổ chức",
    "id": "A.5.33",
    "question": "(A.5.33) Các hồ sơ quan trọng (log, hợp đồng) có được bảo vệ khỏi mất mát, sửa đổi và được lưu trữ đủ thời gian không?",
    "explanation": "<b>Ý nghĩa:</b> Log phải lưu đủ lâu (VD: 12 tháng theo luật) để phục vụ điều tra.<br><b>Bằng chứng:</b> Chính sách lưu trữ, cấu hình retention trên hệ thống log."
  },
  {
    "section": "A.5 Tổ chức",
    "id": "A.5.34",
    "question": "(A.5.34) Nếu tổ chức xử lý Thông tin Cá nhân (PII), các biện pháp nào được áp dụng để tuân thủ quy định (Nghị định 13)?",
    "explanation": "<b>Ý nghĩa:</b> Bảo vệ dữ liệu cá nhân, lấy sự đồng ý khi thu thập.<br><b>Bằng chứng:</b> Chính sách bảo vệ dữ liệu cá nhân, Form đồng ý (Consent)."
  },
  {
    "section": "A.5 Tổ chức",
    "id": "A.5.35",
    "question": "(A.5.35) Việc rà soát ISMS (Đánh giá nội bộ 9.2) có được thực hiện bởi những người khách quan, độc lập không?",
    "explanation": "<b>Ý nghĩa:</b> Đảm bảo công bằng. Không tự đánh giá việc mình làm.<br><b>Bằng chứng:</b> Quyết định thành lập đoàn đánh giá (chéo giữa các phòng)."
  },
  {
    "section": "A.5 Tổ chức",
    "id": "A.5.36",
    "question": "(A.5.36) Tổ chức có cơ chế nào để đảm bảo nhân viên tuân thủ các chính sách ATTT (ví dụ: kiểm tra, kỷ luật)?",
    "explanation": "<b>Ý nghĩa:</b> Có thưởng có phạt để đảm bảo thực thi chính sách.<br><b>Bằng chứng:</b> Quy định khen thưởng/kỷ luật ATTT."
  },
  {
    "section": "A.5 Tổ chức",
    "id": "A.5.37",
    "question": "(A.5.37) Các quy trình vận hành (ví dụ: backup, vá lỗi) có được tài liệu hóa và sẵn có cho người thực hiện không?",
    "explanation": "<b>Ý nghĩa:</b> Tránh phụ thuộc vào trí nhớ cá nhân. Vận hành phải có hướng dẫn (SOP).<br><b>Bằng chứng:</b> Tài liệu hướng dẫn vận hành (SOP) cho Sysadmin."
  },

  // === PHẦN 3: ANNEX A.6 - CON NGƯỜI (PEOPLE) ===
  {
    "section": "A.6 Con người",
    "id": "A.6.1",
    "question": "(A.6.1) Quy trình HR có bao gồm việc kiểm tra lý lịch (screening) cho các vị trí nhạy cảm (IT, Tài chính) trước khi tuyển dụng không?",
    "explanation": "<b>Ý nghĩa:</b> Tránh tuyển 'sói vào nhà'. Kiểm tra tiền án tiền sự/lừa đảo nếu cần.<br><b>Bằng chứng:</b> Quy trình tuyển dụng, hồ sơ check background."
  },
  {
    "section": "A.6 Con người",
    "id": "A.6.2",
    "question": "(A.6.2) Hợp đồng lao động hoặc thỏa thuận có bao gồm các điều khoản về trách nhiệm ATTT của nhân viên không?",
    "explanation": "<b>Ý nghĩa:</b> Ràng buộc pháp lý trách nhiệm bảo mật ngay từ đầu.<br><b>Bằng chứng:</b> Hợp đồng lao động mẫu, Cam kết bảo mật (NDA)."
  },
  {
    "section": "A.6 Con người",
    "id": "A.6.3",
    "question": "(A.6.3) Đã có bằng chứng đào tạo nhận thức ATTT hàng năm (slide, danh sách tham dự)? (Giống 7.3)",
    "explanation": "<b>Ý nghĩa:</b> Nhắc lại kiến thức định kỳ vì thủ đoạn lừa đảo luôn mới.<br><b>Bằng chứng:</b> Hồ sơ các lớp đào tạo nhận thức đã tổ chức."
  },
  {
    "section": "A.6 Con người",
    "id": "A.6.4",
    "question": "(A.6.4) Tổ chức có quy trình kỷ luật (trong Nội quy lao động) nếu nhân viên vi phạm chính sách ATTT không?",
    "explanation": "<b>Ý nghĩa:</b> Răn đe để đảm bảo tuân thủ.<br><b>Bằng chứng:</b> Nội quy lao động (có mục xử lý vi phạm ATTT)."
  },
  {
    "section": "A.6 Con người",
    "id": "A.6.5",
    "question": "(A.6.5) Quy trình nghỉ việc (Off-boarding) có bao gồm việc nhắc nhở/ràng buộc trách nhiệm bảo mật sau khi nghỉ không?",
    "explanation": "<b>Ý nghĩa:</b> Nghỉ rồi vẫn phải giữ bí mật công ty cũ.<br><b>Bằng chứng:</b> Biên bản thanh lý hợp đồng (có điều khoản bảo mật)."
  },
  {
    "section": "A.6 Con người",
    "id": "A.6.6",
    "question": "(A.6.6) Nhân viên và nhà thầu có ký Thỏa thuận Bảo mật (NDA / Confidentiality Agreement) không?",
    "explanation": "<b>Ý nghĩa:</b> Văn bản bắt buộc trước khi cho tiếp cận thông tin nhạy cảm.<br><b>Bằng chứng:</b> Các NDA đã ký được lưu trữ."
  },
  {
    "section": "A.6 Con người",
    "id": "A.6.7",
    "question": "(A.6.7) Đã có chính sách và các biện pháp kỹ thuật (VPN, MFA, mã hóa) cho nhân viên làm việc từ xa (Remote working) chưa?",
    "explanation": "<b>Ý nghĩa:</b> Làm việc ở nhà rủi ro hơn. Cần VPN và MFA để bảo vệ.<br><b>Bằng chứng:</b> Chính sách WFH, cấu hình VPN/MFA."
  },
  {
    "section": "A.6 Con người",
    "id": "A.6.8",
    "question": "(A.6.8) Phỏng vấn nhân viên: Nếu nhận được email lạ, họ biết cách báo cáo sự cố (cho IT/Helpdesk) theo Quy trình 2.2 không?",
    "explanation": "<b>Ý nghĩa:</b> Kiểm tra hiệu quả đào tạo. Nhân viên phải biết nút báo cáo ở đâu.<br><b>Bằng chứng:</b> Kết quả phỏng vấn ngẫu nhiên hoặc diễn tập Phishing."
  },

  // === PHẦN 4: ANNEX A.7 - VẬT LÝ (PHYSICAL) ===
  {
    "section": "A.7 Vật lý",
    "id": "A.7.1",
    "question": "(A.7.1) Vòng đai an ninh vật lý (cửa, tường, hàng rào) của văn phòng và phòng server có được xác định và bảo vệ không?",
    "explanation": "<b>Ý nghĩa:</b> Lớp bảo vệ đầu tiên ngăn người lạ đột nhập.<br><b>Bằng chứng:</b> Quan sát thực tế cửa, tường, bảo vệ trực."
  },
  {
    "section": "A.7 Vật lý",
    "id": "A.7.2",
    "question": "(A.7.2) Quan sát: Việc ra vào các khu vực nhạy cảm (văn phòng, phòng server) có được kiểm soát không (thẻ từ, khóa)? Khách có được giám sát/đeo thẻ không?",
    "explanation": "<b>Ý nghĩa:</b> Kiểm soát ai được vào đâu. Khách phải có người kèm.<br><b>Bằng chứng:</b> Hệ thống kiểm soát ra vào (Access Control), sổ nhật ký khách."
  },
  {
    "section": "A.7 Vật lý",
    "id": "A.7.3",
    "question": "(A.7.3) Văn phòng và phòng server có được bảo vệ (khóa cửa, tủ rack) khi không có người giám sát không?",
    "explanation": "<b>Ý nghĩa:</b> Tránh kẻ gian lẻn vào khi vắng người.<br><b>Bằng chứng:</b> Quan sát các tủ rack, cửa phòng khi không có người."
  },
  {
    "section": "A.7 Vật lý",
    "id": "A.7.4",
    "question": "(A.7.4) Quan sát: Có hệ thống giám sát (CCTV) tại các lối ra vào và khu vực nhạy cảm không? Log camera có được lưu trữ và bảo vệ không?",
    "explanation": "<b>Ý nghĩa:</b> Ghi hình để điều tra nếu có mất mát.<br><b>Bằng chứng:</b> Hệ thống CCTV, thời gian lưu trữ video."
  },
  {
    "section": "A.7 Vật lý",
    "id": "A.7.5",
    "question": "(A.7.5) Phòng server có được bảo vệ khỏi các mối đe dọa môi trường không (cháy, ngập, nhiệt độ)? (Bằng chứng: bình chữa cháy, điều hòa, UPS)",
    "explanation": "<b>Ý nghĩa:</b> Chống nóng, ẩm, cháy, mất điện cho thiết bị.<br><b>Bằng chứng:</b> Hệ thống báo/chữa cháy, điều hòa, UPS, cảm biến môi trường."
  },
  {
    "section": "A.7 Vật lý",
    "id": "A.7.6",
    "question": "(A.7.6) Các quy tắc làm việc tại khu vực an toàn (phòng server) có được định nghĩa và tuân thủ không (ví dụ: hạn chế mang thiết bị cá nhân)?",
    "explanation": "<b>Ý nghĩa:</b> Phòng server không phải cái kho. Cần quy định rõ việc ra vào.<br><b>Bằng chứng:</b> Nội quy phòng máy chủ."
  },
  {
    "section": "A.7 Vật lý",
    "id": "A.7.7",
    "question": "(A.7.7) Quan sát: Nhân viên có tuân thủ chính sách \"Bàn làm việc sạch\" (không để tài liệu nhạy cảm) và \"Màn hình sạch\" (khóa máy tính khi rời đi) không?",
    "explanation": "<b>Ý nghĩa:</b> Tránh lộ thông tin cho người đi ngang qua.<br><b>Bằng chứng:</b> Quan sát thực tế văn phòng."
  },
  {
    "section": "A.7 Vật lý",
    "id": "A.7.8",
    "question": "(A.7.8) Thiết bị (máy chủ, switch) có được đặt ở vị trí an toàn, giảm thiểu rủi ro bị nhìn trộm hoặc hư hỏng không?",
    "explanation": "<b>Ý nghĩa:</b> Không đặt màn hình máy chủ hướng ra nơi công cộng.<br><b>Bằng chứng:</b> Quan sát vị trí lắp đặt."
  },
  {
    "section": "A.7 Vật lý",
    "id": "A.7.9",
    "question": "(A.7.9) Các biện pháp nào được áp dụng để bảo vệ tài sản (ví dụ: laptop) khi nhân viên mang ra khỏi văn phòng (làm việc từ xa, công tác)?",
    "explanation": "<b>Ý nghĩa:</b> Laptop mang ra ngoài dễ mất. Cần mã hóa ổ cứng để bảo vệ dữ liệu.<br><b>Bằng chứng:</b> Chính sách thiết bị di động, cấu hình Bitlocker."
  },
  {
    "section": "A.7 Vật lý",
    "id": "A.7.10",
    "question": "(A.7.10) Các thiết bị lưu trữ (USB, ổ cứng hỏng) có được quản lý (kiểm soát, cấp phát) và hủy bỏ an toàn (xóa dữ liệu, phá hủy vật lý) khi không còn sử dụng không?",
    "explanation": "<b>Ý nghĩa:</b> Ổ cứng hỏng vứt đi vẫn có thể bị khôi phục dữ liệu. Cần hủy vật lý.<br><b>Bằng chứng:</b> Biên bản hủy tài sản, quy trình hủy dữ liệu."
  },
  {
    "section": "A.7 Vật lý",
    "id": "A.7.11",
    "question": "(A.7.11) Các hệ thống hỗ trợ (điện, điều hòa, mạng) cho phòng server có được bảo vệ, dự phòng (UPS, máy nổ) và bảo trì định kỳ không?",
    "explanation": "<b>Ý nghĩa:</b> Đảm bảo tính liên tục. Mất điện phải có UPS/máy phát.<br><b>Bằng chứng:</b> Hồ sơ bảo trì điện/lạnh, nhật ký chạy máy phát."
  },
  {
    "section": "A.7 Vật lý",
    "id": "A.7.12",
    "question": "(A.7.12) Hệ thống cáp (mạng, điện) có được bảo vệ khỏi việc bị can thiệp hoặc hư hỏng vật lý không (ví dụ: đi trong máng cáp, ống gen)?",
    "explanation": "<b>Ý nghĩa:</b> Tránh chuột cắn hoặc bị cắt trộm/nghe lén.<br><b>Bằng chứng:</b> Quan sát hệ thống máng cáp/ống bảo vệ."
  },
  {
    "section": "A.7 Vật lý",
    "id": "A.7.13",
    "question": "(A.7.13) Thiết bị (máy chủ, UPS) có được bảo trì định kỳ theo lịch của nhà cung cấp không? Hồ sơ bảo trì có được lưu lại không?",
    "explanation": "<b>Ý nghĩa:</b> Bảo trì để phát hiện sớm hỏng hóc.<br><b>Bằng chứng:</b> Kế hoạch và biên bản bảo trì."
  },
  {
    "section": "A.7 Vật lý",
    "id": "A.7.14",
    "question": "(A.7.14) Khi thanh lý hoặc tái sử dụng thiết bị (laptop, máy chủ), tổ chức có đảm bảo mọi dữ liệu nhạy cảm đã được xóa an toàn không?",
    "explanation": "<b>Ý nghĩa:</b> Wipe sạch dữ liệu trước khi bán máy cũ hoặc chuyển người khác dùng.<br><b>Bằng chứng:</b> Quy trình thanh lý, biên bản xóa dữ liệu."
  },

  // === PHẦN 5: ANNEX A.8 - CÔNG NGHỆ (TECHNOLOGICAL) ===
  {
    "section": "A.8 Công nghệ",
    "id": "A.8.1",
    "question": "(A.8.1) Quan sát: Thiết bị đầu cuối (laptop, PC) có được bảo vệ không (cài Antivirus, bật mã hóa ổ cứng, chính sách màn hình khóa tự động)?",
    "explanation": "<b>Ý nghĩa:</b> Bảo vệ máy tính nhân viên - cửa ngõ dễ bị tấn công nhất.<br><b>Bằng chứng:</b> Antivirus trên máy, policy màn hình khóa, mã hóa ổ cứng."
  },
  {
    "section": "A.8 Công nghệ",
    "id": "A.8.2",
    "question": "(A.8.2) Quyền truy cập đặc quyền (admin, root) có bị hạn chế, giám sát và chỉ cấp khi thật sự cần thiết không?",
    "explanation": "<b>Ý nghĩa:</b> Admin là mục tiêu số 1. Cần hạn chế số người biết và giám sát chặt.<br><b>Bằng chứng:</b> Danh sách tài khoản Admin, log sử dụng."
  },
  {
    "section": "A.8 Công nghệ",
    "id": "A.8.3",
    "question": "(A.8.3) Việc truy cập thông tin (ví dụ: ổ đĩa dùng chung, CSDL) có được phân quyền (restriction) dựa trên vai trò, chức năng không?",
    "explanation": "<b>Ý nghĩa:</b> Không share 'Everyone Full Control'. Phòng nào chỉ xem dữ liệu phòng đó.<br><b>Bằng chứng:</b> Cấu hình phân quyền trên File Server/Database."
  },
  {
    "section": "A.8 Công nghệ",
    "id": "A.8.4",
    "question": "(A.8.4) (Nếu có) Quyền truy cập mã nguồn (source code) có được kiểm soát chặt chẽ (phân quyền trên Git, SVN) không?",
    "explanation": "<b>Ý nghĩa:</b> Bảo vệ tài sản lõi (code) khỏi bị lộ hoặc sửa trộm.<br><b>Bằng chứng:</b> Phân quyền trên GitLab/GitHub."
  },
  {
    "section": "A.8 Công nghệ",
    "id": "A.8.5",
    "question": "(A.8.5) Hệ thống có cung cấp cơ chế xác thực an toàn không (ví dụ: không truyền mật khẩu clear text, có MFA)?",
    "explanation": "<b>Ý nghĩa:</b> Đăng nhập phải an toàn (HTTPS, MFA).<br><b>Bằng chứng:</b> Cấu hình xác thực (SSO, MFA)."
  },
  {
    "section": "A.8 Công nghệ",
    "id": "A.8.6",
    "question": "(A.8.6) Tổ chức có giám sát dung lượng (capacity) của các hệ thống quan trọng (CPU, RAM, disk, bandwidth) để dự báo và mở rộng kịp thời không?",
    "explanation": "<b>Ý nghĩa:</b> Tránh sập hệ thống do đầy ổ cứng/quá tải.<br><b>Bằng chứng:</b> Công cụ giám sát (Zabbix, SolarWinds) và báo cáo capacity."
  },
  {
    "section": "A.8 Công nghệ",
    "id": "A.8.7",
    "question": "(A.8.7) Tổ chức có giải pháp bảo vệ chống mã độc (Antivirus/Antimalware) trên máy chủ, máy trạm không? Giải pháp này có được cập nhật thường xuyên không?",
    "explanation": "<b>Ý nghĩa:</b> Lớp bảo vệ cơ bản chống virus/ransomware.<br><b>Bằng chứng:</b> Dashboard Antivirus tập trung, ngày cập nhật signature."
  },
  {
    "section": "A.8 Công nghệ",
    "id": "A.8.8",
    "question": "(A.8.8) Đã có báo cáo quét lỗ hổng (Vulnerability Scan) gần nhất chưa? Các lỗ hổng \"Nghiêm trọng\" (Critical) đã được xử lý (vá lỗi) chưa?",
    "explanation": "<b>Ý nghĩa:</b> Chủ động tìm và vá lỗi trước khi hacker khai thác.<br><b>Bằng chứng:</b> Báo cáo scan (Nessus/Qualys) và ticket vá lỗi."
  },
  {
    "section": "A.8 Công nghệ",
    "id": "A.8.9",
    "question": "(A.8.9) Tổ chức có áp dụng cấu hình an toàn (hardening) cho các hệ thống mới triển khai (tắt dịch vụ/cổng không cần thiết) không? (Xem Chính sách 1.9)",
    "explanation": "<b>Ý nghĩa:</b> Không dùng cấu hình mặc định vì dễ bị hack. Phải 'cứng hóa' trước khi dùng.<br><b>Bằng chứng:</b> Hardening checklist, kết quả scan compliance."
  },
  {
    "section": "A.8 Công nghệ",
    "id": "A.8.10",
    "question": "(A.8.10) Khi dữ liệu không còn cần thiết, tổ chức có quy trình và công cụ để xóa an toàn (secure deletion) (ví dụ: ghi đè, degauss) không?",
    "explanation": "<b>Ý nghĩa:</b> Xóa thường vẫn khôi phục được. Cần xóa an toàn (ghi đè) dữ liệu nhạy cảm.<br><b>Bằng chứng:</b> Công cụ/quy trình xóa dữ liệu an toàn."
  },
  {
    "section": "A.8 Công nghệ",
    "id": "A.8.11",
    "question": "(A.8.11) (Nếu có) Tổ chức có sử dụng kỹ thuật che giấu dữ liệu (data masking) khi sử dụng dữ liệu thật (production data) cho môi trường thử nghiệm (test) không?",
    "explanation": "<b>Ý nghĩa:</b> Dev không cần biết dữ liệu thật của khách hàng để test. Cần làm mờ đi.<br><b>Bằng chứng:</b> Quy trình tạo dữ liệu test, công cụ masking."
  },
  {
    "section": "A.8 Công nghệ",
    "id": "A.8.12",
    "question": "(A.8.12) Tổ chức có các biện pháp ngăn chặn rò rỉ dữ liệu (DLP) không (ví dụ: chặn USB, giám sát email, DLP gateway)?",
    "explanation": "<b>Ý nghĩa:</b> Ngăn nhân viên gửi dữ liệu mật ra ngoài.<br><b>Bằng chứng:</b> Giải pháp DLP, quy định chặn USB."
  },
  {
    "section": "A.8 Công nghệ",
    "id": "A.8.13",
    "question": "(A.8.13) Đã có log sao lưu (backup) thành công của các hệ thống quan trọng (từ đêm qua) chưa? (Xem Chính sách 1.3)",
    "explanation": "<b>Ý nghĩa:</b> Cứu cánh cuối cùng khi bị ransomware. Phải backup thành công và test restore.<br><b>Bằng chứng:</b> Log backup, biên bản test khôi phục."
  },
  {
    "section": "A.8 Công nghệ",
    "id": "A.8.14",
    "question": "(A.8.14) Các biện pháp nào (ví dụ: HA, clustering, load balancing) được sử dụng để đảm bảo tính sẵn sàng (availability) của thông tin/dịch vụ?",
    "explanation": "<b>Ý nghĩa:</b> Một máy chết dịch vụ vẫn chạy. Cần dự phòng nóng (HA).<br><b>Bằng chứng:</b> Sơ đồ kiến trúc HA, cấu hình Load Balancer."
  },
  {
    "section": "A.8 Công nghệ",
    "id": "A.8.15",
    "question": "(A.8.15) Các hệ thống quan trọng (máy chủ, firewall, CSDL) có được bật ghi nhật ký (logging) các sự kiện quan trọng không? (Xem Chính sách 1.8)",
    "explanation": "<b>Ý nghĩa:</b> 'Hộp đen' để điều tra sự cố. Phải bật ghi log.<br><b>Bằng chứng:</b> Cấu hình audit log trên các thiết bị."
  },
  {
    "section": "A.8 Công nghệ",
    "id": "A.8.16",
    "question": "(A.8.16) Log có được thu thập tập trung (SIEM/Syslog) và rà soát định kỳ (hoặc tự động) để phát hiện bất thường không? Log có được bảo vệ khỏi sửa đổi không?",
    "explanation": "<b>Ý nghĩa:</b> Gom log về một chỗ (SIEM) để dễ phân tích và tránh bị hacker xóa.<br><b>Bằng chứng:</b> Hệ thống SIEM, các rule cảnh báo."
  },
  {
    "section": "A.8 Công nghệ",
    "id": "A.8.17",
    "question": "(A.8.17) Tất cả các hệ thống trong phạm vi có được đồng bộ hóa thời gian (clock synchronization) với một nguồn chuẩn (NTP server) không?",
    "explanation": "<b>Ý nghĩa:</b> Để log chính xác phục vụ điều tra.<br><b>Bằng chứng:</b> Cấu hình NTP."
  },
  {
    "section": "A.8 Công nghệ",
    "id": "A.8.18",
    "question": "(A.8.18) Việc sử dụng các tiện ích đặc quyền (ví dụ: các công cụ admin, debug) có được kiểm soát và hạn chế không?",
    "explanation": "<b>Ý nghĩa:</b> Chỉ admin mới được dùng các công cụ mạnh.<br><b>Bằng chứng:</b> Danh sách phần mềm được phép (Whitelist)."
  },
  {
    "section": "A.8 Công nghệ",
    "id": "A.8.19",
    "question": "(A.8.19) Việc cài đặt phần mềm trên hệ thống vận hành (production) có được kiểm soát (thông qua Quản lý Thay đổi) không? Người dùng có bị cấm tự ý cài đặt không?",
    "explanation": "<b>Ý nghĩa:</b> Production phải ổn định, không được tùy tiện cài cắm.<br><b>Bằng chứng:</b> Quy định cài đặt, chặn quyền admin của user thường."
  },
  {
    "section": "A.8 Công nghệ",
    "id": "A.8.20",
    "question": "(A.8.20) Xem cấu hình Tường lửa (Firewall): Mạng có được phân đoạn (network segregation) thành các vùng (DMZ, LAN, Wifi, Server) không? (Xem Chính sách 1.9)",
    "explanation": "<b>Ý nghĩa:</b> Chia để trị. LAN nhiễm virus không được lây sang Server.<br><b>Bằng chứng:</b> Sơ đồ mạng, cấu hình VLAN/Firewall."
  },
  {
    "section": "A.8 Công nghệ",
    "id": "A.8.21",
    "question": "(A.8.21) Các dịch vụ mạng (network services) có được cấu hình an toàn, tắt các tính năng không cần thiết không?",
    "explanation": "<b>Ý nghĩa:</b> Chỉ bật những gì cần thiết (Least Functionality).<br><b>Bằng chứng:</b> Scan port, hardening thiết bị mạng."
  },
  {
    "section": "A.8 Công nghệ",
    "id": "A.8.22",
    "question": "(A.8.22) Việc lọc và kiểm soát luồng thông tin (traffic) giữa các phân đoạn mạng có được thực hiện (trên Firewall/Router) không?",
    "explanation": "<b>Ý nghĩa:</b> Dùng firewall chặn kết nối không được phép giữa các vùng.<br><b>Bằng chứng:</b> Review rule firewall."
  },
  {
    "section": "A.8 Công nghệ",
    "id": "A.8.23",
    "question": "(A.8.23) Tổ chức có giải pháp lọc web (web filtering) để chặn truy cập đến các trang web độc hại/không phù hợp không? (Xem Chính sách 1.9)",
    "explanation": "<b>Ý nghĩa:</b> Ngăn nhân viên vào web đen, web mã độc.<br><b>Bằng chứng:</b> Cấu hình Web Proxy/Filter."
  },
  {
    "section": "A.8 Công nghệ",
    "id": "A.8.24",
    "question": "(A.8.24) Tổ chức có chính sách và biện pháp sử dụng mật mã (cryptography) để bảo vệ thông tin không (ví dụ: mã hóa ổ cứng, SSL/TLS, mã hóa backup)?",
    "explanation": "<b>Ý nghĩa:</b> Dùng mã hóa chuẩn để bảo vệ tính bí mật.<br><b>Bằng chứng:</b> Chính sách mã hóa, cấu hình SSL/TLS."
  },
  {
    "section": "A.8 Công nghệ",
    "id": "A.8.25",
    "question": "(A.8.25) (Nếu có) Quy trình phát triển phần mềm có tuân theo một vòng đời phát triển an toàn (secure development life cycle - SDLC) không?",
    "explanation": "<b>Ý nghĩa:</b> Bảo mật từ thiết kế (Security by Design).<br><b>Bằng chứng:</b> Quy trình DevSecOps/SDLC."
  },
  {
    "section": "A.8 Công nghệ",
    "id": "A.8.26",
    "question": "(A.8.26) (Nếu có) Các yêu cầu ATTT (application security requirements) có được xác định và tích hợp vào quá trình phát triển không?",
    "explanation": "<b>Ý nghĩa:</b> Xác định yêu cầu bảo mật trước khi code.<br><b>Bằng chứng:</b> Tài liệu SRS có mục yêu cầu bảo mật."
  },
  {
    "section": "A.8 Công nghệ",
    "id": "A.8.27",
    "question": "(A.8.27) (Nếu có) Các nguyên tắc kiến trúc và kỹ thuật an toàn có được áp dụng khi xây dựng hệ thống không?",
    "explanation": "<b>Ý nghĩa:</b> Áp dụng các mô hình chuẩn (Zero Trust, Defense in Depth).<br><b>Bằng chứng:</b> Tài liệu thiết kế kiến trúc (HLD/LLD)."
  },
  {
    "section": "A.8 Công nghệ",
    "id": "A.8.28",
    "question": "(A.8.28) (Nếu có) Lập trình viên có được đào tạo và áp dụng các nguyên tắc lập trình an toàn (secure coding) (ví dụ: OWASP Top 10) không?",
    "explanation": "<b>Ý nghĩa:</b> Coder phải biết tránh lỗi cơ bản (SQLi, XSS).<br><b>Bằng chứng:</b> Chứng chỉ đào tạo Secure Coding."
  },
  {
    "section": "A.8 Công nghệ",
    "id": "A.8.29",
    "question": "(A.8.29) (Nếu có) Việc kiểm thử an toàn (security testing, ví dụ: VAPT, SAST/DAST) có được thực hiện trước khi triển khai (go-live) không?",
    "explanation": "<b>Ý nghĩa:</b> Test kỹ trước khi tung ra (scan code, pentest).<br><b>Bằng chứng:</b> Báo cáo Pentest/Scan trước khi go-live."
  },
  {
    "section": "A.8 Công nghệ",
    "id": "A.8.30",
    "question": "(A.8.30) (Nếu có) Nếu thuê ngoài phát triển phần mềm, tổ chức có các biện pháp kiểm soát ATTT (hợp đồng, rà soát code) không?",
    "explanation": "<b>Ý nghĩa:</b> Kiểm soát chặt code thuê ngoài.<br><b>Bằng chứng:</b> Hợp đồng outsource (có điều khoản bảo mật), biên bản review code."
  },
  {
    "section": "A.8 Công nghệ",
    "id": "A.8.31",
    "question": "(A.8.31) (Nếu có) Môi trường Phát triển (Dev), Thử nghiệm (Test) và Vận hành (Production) có được tách biệt (segregation) không?",
    "explanation": "<b>Ý nghĩa:</b> Môi trường test bị hack không ảnh hưởng môi trường thật.<br><b>Bằng chứng:</b> Kiến trúc mạng tách biệt, quy trình deploy."
  },
  {
    "section": "A.8 Công nghệ",
    "id": "A.8.32",
    "question": "(A.8.32) Đã có bằng chứng (ticket, RFC) cho thấy các thay đổi (cấu hình, phần mềm) được phê duyệt, kiểm tra (theo QT 2.6) trước khi triển khai không?",
    "explanation": "<b>Ý nghĩa:</b> Kiểm soát deploy chặt chẽ để tránh lỗi.<br><b>Bằng chứng:</b> Ticket Change Management (RFC) đã duyệt."
  },
  {
    "section": "A.8 Công nghệ",
    "id": "A.8.33",
    "question": "(A.8.33) (Nếu có) Dữ liệu thử nghiệm (test information) có được bảo vệ và lựa chọn cẩn thận (tránh dùng dữ liệu PII thật) không?",
    "explanation": "<b>Ý nghĩa:</b> Tránh dùng dữ liệu thật để test.<br><b>Bằng chứng:</b> Quy trình quản lý dữ liệu test."
  },
  {
    "section": "A.8 Công nghệ",
    "id": "A.8.34",
    "question": "(A.8.34) Các hoạt động đánh giá (audit tests, pentest) có được lập kế hoạch và giám sát để giảm thiểu rủi ro gián đoạn hệ thống vận hành không?",
    "explanation": "<b>Ý nghĩa:</b> Pentest không được làm sập hệ thống thật.<br><b>Bằng chứng:</b> Kế hoạch pentest, quy định Rules of Engagement (RoE)."
  }
];

// --- Trạng thái Ứng dụng ---
let currentQuestionIndex = 0;
let clientName = "";
let auditResults = [];
let isDirty = false;
const totalQuestions = CHECKLIST_DATA.length;
let sections = []; 

// --- DOM Elements ---
const screens = {
    setup: document.getElementById('screen-setup'),
    audit: document.getElementById('screen-audit'),
    done: document.getElementById('screen-done')
};
const clientNameInput = document.getElementById('clientName');
const startButton = document.getElementById('startButton');
const clientNameDisplay = document.getElementById('clientNameDisplay');
const saveReportButton = document.getElementById('saveReportButton');
const restartButton = document.getElementById('restartButton');
const sectionList = document.getElementById('sectionList'); 
const progressText = document.getElementById('progressText');
const progressBar = document.getElementById('progressBar');
const controlSection = document.getElementById('controlSection');
const controlId = document.getElementById('controlId');
const controlQuestion = document.getElementById('controlQuestion');
const controlStatus = document.getElementById('controlStatus');
const controlEvidenceUpload = document.getElementById('controlEvidenceUpload');
const evidenceStatus = document.getElementById('evidenceStatus');
const controlNote = document.getElementById('controlNote');
const prevButton = document.getElementById('prevButton');
const nextButton = document.getElementById('nextButton');
const controlCounter = document.getElementById('controlCounter');
const reportFileName = document.getElementById('reportFileName');

// --- Functions ---

// Cảnh báo khi định rời trang nếu chưa lưu
window.addEventListener('beforeunload', (e) => {
    if (isDirty) {
        e.preventDefault();
        e.returnValue = ''; 
    }
});

function showScreen(screenId) {
    Object.values(screens).forEach(screen => screen.classList.remove('active'));
    screens[screenId].classList.add('active');
}

function populateSidebar() {
    sections = [...new Set(CHECKLIST_DATA.map(item => item.section))];
    sectionList.innerHTML = ''; 
    sections.forEach(section => {
        const li = document.createElement('li');
        const button = document.createElement('button');
        button.className = "w-full text-left p-3 rounded-lg font-medium text-gray-700 hover:bg-emerald-50 transition duration-150";
        button.textContent = section;
        button.onclick = () => jumpToSection(section);
        li.appendChild(button);
        sectionList.appendChild(li);
    });
}

function updateSidebarHighlight(currentSection) {
    const buttons = document.querySelectorAll('#sectionList button');
    buttons.forEach(button => {
        if (button.textContent === currentSection) {
											   
																					 
            button.classList.add('active');
        } else {
            button.classList.remove('active');
        }
    });
}

function jumpToSection(sectionName) {
    saveCurrentAnswer();
    const newIndex = CHECKLIST_DATA.findIndex(item => item.section === sectionName);
    if (newIndex !== -1) {
        currentQuestionIndex = newIndex;
        loadQuestion(currentQuestionIndex);
        updateProgress();
    }
}

function startAudit() {
    clientName = clientNameInput.value.trim();
    if (clientName === "") {
        alert("Vui lòng nhập tên khách hàng.");
        return;
    }
    clientNameDisplay.textContent = clientName;
    
    auditResults = CHECKLIST_DATA.map(item => ({
        ...item,
        status: "Bỏ qua",
        note: "",
        evidence_file: ""
    }));

    populateSidebar();
    currentQuestionIndex = 0;
    loadQuestion(currentQuestionIndex);
    updateProgress();
    showScreen('audit');
    isDirty = true;
}

function loadQuestion(index) {
    const item = CHECKLIST_DATA[index];
    const result = auditResults[index];

    controlSection.textContent = item.section;
    controlId.textContent = item.id;
    controlQuestion.textContent = item.question;
    controlStatus.value = result.status;
    
    if (result.evidence_file) {
        evidenceStatus.innerHTML = `Đã lưu: <a href="${result.evidence_file}" target="_blank" class="text-emerald-600 underline font-medium hover:text-emerald-800">${result.evidence_file.split('/').pop()}</a>`;
        evidenceStatus.className = 'mt-3 text-sm text-emerald-600 flex items-center';
    } else {
        evidenceStatus.textContent = 'Chưa có file bằng chứng.';
        evidenceStatus.className = 'mt-3 text-sm text-gray-400 flex items-center';
    }
    controlEvidenceUpload.value = null;
    controlNote.value = result.note;
    controlCounter.textContent = `${index + 1} / ${totalQuestions}`;
    updateSidebarHighlight(item.section);
    
    prevButton.disabled = (index === 0);
    prevButton.classList.toggle('opacity-50', index === 0);
    prevButton.classList.toggle('cursor-not-allowed', index === 0);
    
    if (index === totalQuestions - 1) {
        nextButton.innerHTML = `Hoàn thành <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>`;
        nextButton.classList.remove('bg-emerald-600', 'hover:bg-emerald-700');
        nextButton.classList.add('bg-emerald-800', 'hover:bg-emerald-900');
    } else {
        nextButton.innerHTML = `Tiếp theo <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" /></svg>`;
        nextButton.classList.add('bg-emerald-600', 'hover:bg-emerald-700');
        nextButton.classList.remove('bg-emerald-800', 'hover:bg-emerald-900');
    }

    // --- Xử lý hiển thị Hướng dẫn/Gợi ý ---
    const explanationArea = document.getElementById('explanationArea');
    const explanationContent = document.getElementById('explanationContent');
    const toggleExplanation = document.getElementById('toggleExplanation');

    if (item.explanation) {
        explanationArea.classList.remove('hidden');
        explanationContent.innerHTML = item.explanation;
        explanationContent.classList.add('hidden');
        
        const newToggleButton = toggleExplanation.cloneNode(true);
        toggleExplanation.parentNode.replaceChild(newToggleButton, toggleExplanation);
        
        newToggleButton.addEventListener('click', () => {
            explanationContent.classList.toggle('hidden');
        });
    } else {
        explanationArea.classList.add('hidden');
    }
									  
}

async function handleFileUpload(event) {
    const file = event.target.files[0];
    if (!file) return;

    evidenceStatus.textContent = `Đang tải lên: ${file.name}...`;
    evidenceStatus.className = 'mt-3 text-sm text-amber-600 flex items-center font-medium';

    const formData = new FormData();
    formData.append('file', file);

    const safeClientName = clientName
        ? clientName.trim().replace(/[^a-z0-9]/gi, '-').toLowerCase()
        : 'unknown-client';

    try {
        const response = await fetch('/api/upload', {
            method: 'POST',
            headers: {
                'x-client-name': safeClientName
            },
            body: formData,
        });

        if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.error || 'Upload thất bại.');
        }

        const data = await response.json();
        const fileUrl = data.url;

        auditResults[currentQuestionIndex].evidence_file = fileUrl;
													 
        evidenceStatus.innerHTML = `Thành công: <a href="${fileUrl}" target="_blank" class="text-emerald-600 underline font-medium hover:text-emerald-800">${file.name.split('/').pop()}</a>`;
        evidenceStatus.className = 'mt-3 text-sm text-emerald-600 flex items-center';
        event.target.value = null; 

    } catch (error) {
        console.error(error);
        evidenceStatus.textContent = `Lỗi: Tải file thất bại. ${error.message}`;
        evidenceStatus.className = 'mt-3 text-sm text-red-600 flex items-center font-medium';
    }
}

function saveCurrentAnswer() {
    const currentResult = auditResults[currentQuestionIndex];
    if (currentResult) {
        currentResult.status = controlStatus.value;
        currentResult.note = controlNote.value.trim();
    }
}

function nextQuestion() {
    saveCurrentAnswer();
    updateProgress();
    if (currentQuestionIndex < totalQuestions - 1) {
        currentQuestionIndex++;
        loadQuestion(currentQuestionIndex);
    } else {
        generateReport();
    }
}

function prevQuestion() {
    saveCurrentAnswer();
    updateProgress();
    if (currentQuestionIndex > 0) {
        currentQuestionIndex--;
        loadQuestion(currentQuestionIndex);
    }
}

function updateProgress() {
    const answeredCount = auditResults.filter(r => r.status !== "Bỏ qua").length;
    const progressPercent = (answeredCount / totalQuestions) * 100;
    progressText.textContent = `${answeredCount}/${totalQuestions}`;
    progressBar.style.setProperty('--progress-width', `${progressPercent}%`);
}

function generateReport() {
    if (!confirm("Bạn có chắc muốn hoàn thành và tạo báo cáo?")) return;

    saveCurrentAnswer();
    updateProgress();

    const timestamp = new Date().strftime("%Y-%m-%d");
    const safeClientName = clientName.replace(/[^a-z0-9]/gi, '_').toLowerCase();
    const fileName = `Bao_cao_Audit_ISO27001_${safeClientName}_${timestamp}.md`;

    let reportContent = `# BÁO CÁO AUDIT ISO 27001:2022\n\n`;
    reportContent += `**Tổ chức:** ${clientName}\n`;
    reportContent += `**Ngày Audit:** ${timestamp}\n\n`;

    reportContent += "## 1. Tóm tắt các Điểm không Tuân thủ (NCs)\n\n";
    reportContent += "| ID Control | Phát hiện (Finding) | Bằng chứng Tham chiếu |\n";
    reportContent += "| :--- | :--- | :--- |\n";
    
    const ncs = auditResults.filter(res => res.status === "Không Tuân thủ (NC)");
    if (ncs.length === 0) {
        reportContent += "| (Không có) | *Không phát hiện NC nào trong lần audit này.* | |\n";
    } else {
        ncs.forEach(res => {
            let evidenceText = res.evidence_file;
            if (evidenceText.startsWith('http')) {
                evidenceText = `[Link Bằng chứng](${evidenceText})`;
            }
            reportContent += `| ${res.id} | ${res.note} | ${evidenceText} |\n`;
        });
    }

    reportContent += "\n\n## 2. Chi tiết Kết quả Audit\n\n";
    reportContent += "| Phần | ID | Trạng thái | Bằng chứng / Ghi chú | File Bằng chứng Tham chiếu |\n";
    reportContent += "| :--- | :--- | :--- | :--- | :--- |\n";
    
    auditResults.forEach(res => {
        if (res.status !== "Bỏ qua") {
            let evidenceText = res.evidence_file;
            if (evidenceText.startsWith('http')) {
                evidenceText = `[Link Bằng chứng](${evidenceText})`;
            }
            reportContent += `| ${res.section} | ${res.id} | ${res.status} | ${res.note} | ${evidenceText} |\n`;
        }
    });

    try {
        const blob = new Blob([reportContent], { type: "text/markdown;charset=utf-8" });
        saveAs(blob, fileName);
        reportFileName.textContent = fileName;
        showScreen('done');
        isDirty = false;
    } catch (e) {
        console.error("Lỗi khi lưu file:", e);
        alert("LỖI: Không thể tạo file báo cáo.");
    }
}

Date.prototype.strftime = function(format) {
    const date = this;
    return format.replace(/%[Ymd]/g, function(match) {
        switch (match) {
            case '%Y': return date.getFullYear();
            case '%m': return ('0' + (date.getMonth() + 1)).slice(-2);
            case '%d': return ('0' + date.getDate()).slice(-2);
        }
    });
};

startButton.addEventListener('click', startAudit);
prevButton.addEventListener('click', prevQuestion);
nextButton.addEventListener('click', nextQuestion);
saveReportButton.addEventListener('click', generateReport);
controlEvidenceUpload.addEventListener('change', handleFileUpload);
restartButton.addEventListener('click', () => {
    clientNameInput.value = "";
    auditResults = [];
    currentQuestionIndex = 0;
    sectionList.innerHTML = '';
    showScreen('setup');
});
</script>
</body>
</html>